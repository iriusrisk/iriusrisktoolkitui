<!DOCTYPE html><html><head><title>Risk Patterns for aws-lambda.xml</title><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script></head><body><center><h2>Risk patterns for aws-lambda.xml<h2></center><div class="accordion" id="components"><div class="card border-primary"><div class="card-header " id="heading12"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse12" aria-expanded="true" aria-controls="collapse12">Risk pattern: AWS Lambda: Access sensitive data <span>[aws-lambda-access-sensitive-data]</span></button></h5></div><div id="collapse12" class="collapse" aria-labelledby="heading12" data-parent="#components"><div class="card-body"><div class="accordion" id="usecases"><div class="card border-black"><div class="card-header " id="heading5"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse5" aria-expanded="true" aria-controls="collapse5">Use case: Sensitive information in data stores <span>[SENSITIVE INFORMATION IN DATA STORES]</span></button></h5></div><div id="collapse5" class="collapse" aria-labelledby="heading5" data-parent="#usecases"><div class="card-body"><div class="accordion" id="threats"><div class="card border-danger"><div class="card-header " id="heading4"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse4" aria-expanded="true" aria-controls="collapse4">Threat: Sensitive information is leaked from data stores <span>[AWS-LAMBDA-T1]</span></button></h5></div><div id="collapse4" class="collapse" aria-labelledby="heading4" data-parent="#threats"><div class="card-body">	<p>Sensitive information is exfiltrated from a data store because there is no encryption applied or the server was misconfigured</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading1"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse1" aria-expanded="true" aria-controls="collapse1">Weakness: Sensitive stored information was not encrypted at rest <span>[AWS-LAMBDA-W1]</span></button></h5></div><div id="collapse1" class="collapse" aria-labelledby="heading1" data-parent="#weaknesses"><div class="card-body">Because sensitive information is stored in cleartext, attackers could potentially read it. Even if the information is encoded in a way that is not human-readable, certain techniques could determine which encoding is used and decode the information.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading0"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse0" aria-expanded="true" aria-controls="collapse0">Countermeasure: Encrypt sensitive data at rest with KMS <span>[Hydras-AWS-S3-7.4]</span></button></h5></div><div id="collapse0" class="collapse" aria-labelledby="heading0" data-parent="#controls"><div class="card-body"><p>Amazon Simple Storage Service is storage for the Internet. It is designed to make web-scale computing easier for developers. </p> 
<p>Amazon S3 has a simple web services interface that you can use to store and retrieve any amount of data, at any time, from anywhere on the web. It gives any developer access to the same highly scalable, reliable, fast, inexpensive data storage infrastructure that Amazon uses to run its own global network of web sites. </p> 
<p>To ensure that sensitive data is encrypted at rest you can use AWS KMS–managed keys (SSE-KMS). This provides several advantages: <br /></p> 
<ul> 
 <li>You can create and manage the CMK encryption keys yourself.&nbsp;</li> 
 <li>You can use a single CMK to encrypt and decrypt log files for multiple accounts across all regions.&nbsp;</li> 
 <li>You have control over who can use your key for encrypting and decrypting CloudTrail log files. You can assign permissions for the key to the users in your organization according to your requirements.&nbsp;</li> 
 <li>You have enhanced security. With this feature, in order to read log files, you now need to meet two conditions: 1) you must have S3 read permission on the bucket, and 2) you must be granted decrypt permission by the CMK policy.</li> 
</ul> 
<p></p> 
<p>It is recommended to encrypt all sensitive data with SSE-KMS to avoid undue disclosure of information and provide an extra layer of security.</p> 
<p><b>Remediation: </b><br /> The following example shows how to upload data using AWS KMS Encryption: <br /> aws s3api put-object --bucket --server-side-encryption aws:kms --ssekms-key-id --key </p> 
<p>Content provided by Hydras IT LTD</p></div></div></div></div></div></div></div><div class="card border-warning"><div class="card-header " id="heading3"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse3" aria-expanded="true" aria-controls="collapse3">Weakness: The Data Store is directly exposed to the internet <span>[AWS-LAMBDA-W2]</span></button></h5></div><div id="collapse3" class="collapse" aria-labelledby="heading3" data-parent="#weaknesses"><div class="card-body">Data Stores are accessible by the public internet with no - or weak - authentication.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading2"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse2" aria-expanded="true" aria-controls="collapse2">Countermeasure: Not expose your data stores directly to internet <span>[AWS-LAMBDA-C2]</span></button></h5></div><div id="collapse2" class="collapse" aria-labelledby="heading2" data-parent="#controls"><div class="card-body"><p>When using S3 buckets ensure you disable public read access, unless you are using the bucket for storing images or a static website. Ensure data stores are properly protected with firewall settings and gateways. Create specific internal users to access the data store and ensure that only those users can access the data store.</p> 
<p><b>Remediation:</b><br /> To set ACL access permissions for an S3 bucket: <br /></p> 
<ol> 
 <li>Sign in to the AWS Management Console and open the Amazon S3 console at https://console.aws.amazon.com/s3/.&nbsp;</li> 
 <li>In the Bucket name list, choose the name of the bucket that you want to set permissions for.</li> 
 <li>Choose Permissions .</li> 
 <li>You can manage bucket access permissions for the following: Owner access, Access for other AWS accounts, Public access or S3 log delivery group.</li> 
</ol> 
<p></p></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="card border-black"><div class="card-header " id="heading11"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse11" aria-expanded="true" aria-controls="collapse11">Use case: Sensitive information in logs <span>[SENSITIVE INFORMATION IN LOGS]</span></button></h5></div><div id="collapse11" class="collapse" aria-labelledby="heading11" data-parent="#usecases"><div class="card-body"><div class="accordion" id="threats"><div class="card border-danger"><div class="card-header " id="heading10"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse10" aria-expanded="true" aria-controls="collapse10">Threat: Sensitive data is leaked through non-sanitized debugging/logging statements <span>[AWS-LAMBDA-T14]</span></button></h5></div><div id="collapse10" class="collapse" aria-labelledby="heading10" data-parent="#threats"><div class="card-body">	<p>Whilst logging all information may be helpful during development stages, it is important that logging levels be set appropriately before a product ships, ensuring sensitive user data and system information are not exposed to potential attackers.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading7"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse7" aria-expanded="true" aria-controls="collapse7">Weakness: Messages exposed to end users reveal information about serverless functions and the logic used <span>[AWS-LAMBDA-W22]</span></button></h5></div><div id="collapse7" class="collapse" aria-labelledby="heading7" data-parent="#weaknesses"><div class="card-body">Messages to end users must only contain general information and not leak data relating to software implementation or the underlying technology.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading6"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse6" aria-expanded="true" aria-controls="collapse6">Countermeasure: Ensure that sensitive data is not saved into logs files. <span>[AWS-LAMBDA-C29]</span></button></h5></div><div id="collapse6" class="collapse" aria-labelledby="heading6" data-parent="#controls"><div class="card-body">	<p>Review periodically all logs to ensure that sensitive data is not presented in the logs files.</p>

	<p>AWS introduces a new security service Macie recognizing sensitive data such as personally identifiable information (PII) or intellectual property, and provides you with dashboards and alerts that give visibility into how this data is being accessed or moved.</p>

	<p>You can also use the Amazon Macie service to classify all data and find if there is sensitive data in the logs files.</p></div></div></div></div></div></div></div><div class="card border-warning"><div class="card-header " id="heading9"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse9" aria-expanded="true" aria-controls="collapse9">Weakness: Verbose error messages are left in the code and are not removed before moving to production <span>[AWS-LAMBDA-W21]</span></button></h5></div><div id="collapse9" class="collapse" aria-labelledby="heading9" data-parent="#weaknesses"><div class="card-body">Error messages or debugging information must be removed before moving to the production/release branch. This type of information gives an attacker additional insight on the internal working of the application/functions and on the technology used.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading8"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse8" aria-expanded="true" aria-controls="collapse8">Countermeasure: Ensure that sensitive data is not saved into logs files. <span>[AWS-LAMBDA-C29]</span></button></h5></div><div id="collapse8" class="collapse" aria-labelledby="heading8" data-parent="#controls"><div class="card-body">	<p>Review periodically all logs to ensure that sensitive data is not presented in the logs files.</p>

	<p>AWS introduces a new security service Macie recognizing sensitive data such as personally identifiable information (PII) or intellectual property, and provides you with dashboards and alerts that give visibility into how this data is being accessed or moved.</p>

	<p>You can also use the Amazon Macie service to classify all data and find if there is sensitive data in the logs files.</p></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="card border-primary"><div class="card-header " id="heading25"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse25" aria-expanded="true" aria-controls="collapse25">Risk pattern: AWS Lambda: Authentication <span>[aws-lambda-authentication]</span></button></h5></div><div id="collapse25" class="collapse" aria-labelledby="heading25" data-parent="#components"><div class="card-body"><div class="accordion" id="usecases"><div class="card border-black"><div class="card-header " id="heading24"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse24" aria-expanded="true" aria-controls="collapse24">Use case: Authentication <span>[AUTHENTICATION]</span></button></h5></div><div id="collapse24" class="collapse" aria-labelledby="heading24" data-parent="#usecases"><div class="card-body"><div class="accordion" id="threats"><div class="card border-danger"><div class="card-header " id="heading15"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse15" aria-expanded="true" aria-controls="collapse15">Threat: Attackers gain access to a Lambda function through a Cross-site scripting attack on the DynamoDB API <span>[AWS-LAMBDA-T13]</span></button></h5></div><div id="collapse15" class="collapse" aria-labelledby="heading15" data-parent="#threats"><div class="card-body">	<p>Through a Cross-site scripting attack an attacker retrieves credentials. The parameters weren’t validated, resulting in an injection of code to retrieve sensitive data such as as credentials.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading14"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse14" aria-expanded="true" aria-controls="collapse14">Weakness: DynamoDB APIs are vulnerable to XSS <span>[AWS-LAMBDA-W20]</span></button></h5></div><div id="collapse14" class="collapse" aria-labelledby="heading14" data-parent="#weaknesses"><div class="card-body">DynamoDB is a NoSQL database and as such is schemaless. NoSQL databases provide looser consistency restrictions than traditional SQL databases. By requiring fewer relational constraints and consistency checks, NoSQL databases often offer performance and scaling benefits. Yet these databases are still potentially vulnerable to injection attacks, even if they aren't using the traditional SQL syntax.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading13"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse13" aria-expanded="true" aria-controls="collapse13">Countermeasure: Validate all data received <span>[DATA-VAL-GENERIC]</span></button></h5></div><div id="collapse13" class="collapse" aria-labelledby="heading13" data-parent="#controls"><div class="card-body"><p>All data received shall be considered tainted and a potential risk, regardless of the source or transport method. For example, while hidden form fields, cookies, or other headers may be obfuscated from a user, along with parameters passed in ViewStates or other encapsulated forms, these can be modified by the user on the client-side in memory, or in transit on the network. Similarly, data passed from binary or compiled components can be modified in situ or in transit. </p> 
<p>Furthermore, encryption only secures the data in transit between the two ends of the encrypted tunnel (one end of which is typically controlled by the client); data passing through the link may still be malicious.</p> 
<p>As such, all data received must be subjected to strict validation, sanitization, and encoding against expected syntactic and semantic criteria.</p> 
<p> Define a specification of the data that is expected at each input; both the syntax (e.g. alphanumeric only) and semantics (e.g. a word of between 1 and 25 characters, or a specific list). As an example of business rule logic, “boat” may be syntactically valid because it only contains alphanumeric characters, but it is not valid if the input is only expected to contain colors such as “red” or “blue.”<br /> Implement a ‘known good’ or white-list approach, where only inputs that meet the strict criteria for each input are accepted, and reject, transform, or encapsulate any non-compliant data.</p> 
<p> While useful for identifying malicious content, do not rely on looking for specific malformed or attack payloads (blacklists). It is almost impossible to maintain a comprehensive and accurate blacklist due to the complexity and evolving nature of attacks, opportunities to obfuscate payloads, and changes to the code’s execution environment. As noted, blacklists can be useful for detecting and logging potential attacks, or determining which inputs are so malformed that they should be rejected outright.</p> 
<p> Validate all data received from the client, including values such as HTTP headers and cookie values if these are used as input on the server side, X- headers, and other platform specific data objects passed between the client and server.</p></div></div></div></div></div></div></div></div></div></div></div><div class="card border-danger"><div class="card-header " id="heading20"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse20" aria-expanded="true" aria-controls="collapse20">Threat: Attackers gain access to the AWS account through leaked credentials <span>[AWS-LAMBDA-T4]</span></button></h5></div><div id="collapse20" class="collapse" aria-labelledby="heading20" data-parent="#threats"><div class="card-body">	<p>By storing your account information or environment variables in a “public” resource or storing them as plain text, attackers can find that information. Attackers will scan GitHub repositories or scrape/crawl files on your resources to find this kind of information.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading17"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse17" aria-expanded="true" aria-controls="collapse17">Weakness: Environment variables are not stored securely <span>[AWS-LAMBDA-W8]</span></button></h5></div><div id="collapse17" class="collapse" aria-labelledby="heading17" data-parent="#weaknesses"><div class="card-body">Environment variables were stored in plain text configuration files and stored in the code repository<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading16"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse16" aria-expanded="true" aria-controls="collapse16">Countermeasure: Store your environment variables in a secure place. <span>[AWS-LAMBDA-C9]</span></button></h5></div><div id="collapse16" class="collapse" aria-labelledby="heading16" data-parent="#controls"><div class="card-body"><p>Plain text environment variables should not be pushed to code repositories. You can use KMS to encrypt environment variables.</p> 
<p><b>Remediation:<br /></b> Step 1: Create the Lambda Function (If you've already created the Lambda function, skip this step)<br /></p> 
<ol> 
 <li>Sign in to the AWS Management Console and open the AWS Lambda console at https://console.aws.amazon.com/lambda/.</li> 
 <li>Choose Create a Lambda function.</li> 
 <li>In Select blueprint, choose the Author from scratch button.</li> 
 <li>In Basic information, do the following:</li> 
 <ul> 
  <li>In Name, specify your Lambda function name.</li> 
  <li>In Role, choose Choose an existing role.</li> 
  <li>In Existing role, choose lambda_basic_execution.</li> 
  <li>Note: If the policy of the execution role does not have the decrypt permission, you will need add it.</li> 
 </ul> 
 <li>Choose Create function.</li> 
</ol> 
<p></p> 
<p>Step 2: Configure the Lambda Function<br /></p> 
<ol> 
 <li>Under Configuration, specify the Runtime of your choice.</li> 
 <li>Under the Lambda function code section you can take advantage of the Edit code inline option to replace the Lambda function handler code with your custom code.</li> 
 <li>Note the Triggers tab. Under the Triggers page, you can optionally choose a service that automatically triggers your Lambda function by choosing the Add trigger button and then choosing the gray box with ellipses (…) to display a list of available services. For this example, do not configure a trigger and choose Configuration.</li> 
 <li>Note the Monitoring tab. This page will provide immediate CloudWatch metrics for your Lambda function invocations, as well as links to other helpful guides, including Using AWS X-Ray.</li> 
 <li>Expand the Environment variables section.</li> 
 <li>Enter your key-value pair. Expand the Encryption configuration section. Note that Lambda provides a default service key under KMS key to encrypt at rest which encrypts your information after it has been uploaded. If the information you provided is sensitive, you can additionally check the Enable helpers for encryption in transit checkbox and supply a custom key. This masks the value you entered and results in a call to AWS KMS to encrypt the value and return it as Ciphertext. If you haven’t created a KMS key for your account, you will be provided a link to the AWS IAM console to create one. The account must have have encrypt and decrypt permissions for that key. Note that the Encrypt button toggles to Decrypt after you choose it. This affords you the option to update the information. Once you have done that, choose the Encrypt button.</li> 
</ol> 
<p></p></div></div></div></div></div></div></div><div class="card border-warning"><div class="card-header " id="heading19"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse19" aria-expanded="true" aria-controls="collapse19">Weakness: Your AWS credentials were stored in a code repositories such as GitHub <span>[AWS-LAMBDA-W7]</span></button></h5></div><div id="collapse19" class="collapse" aria-labelledby="heading19" data-parent="#weaknesses"><div class="card-body">Monitoring is needed to understand the relationships between all of the objects across a virtual environment’s topology and recognize the difference between inconsequential anomalies and actual performance problems. 
 This will identify root causes and recommended actions for remediation. This way, you can understand what needs your attention, and how to narrow down a problem to the relevant components.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading18"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse18" aria-expanded="true" aria-controls="collapse18">Countermeasure: Ensure that sensitive data is not commited to the repository <span>[AWS-LAMBDA-C8]</span></button></h5></div><div id="collapse18" class="collapse" aria-labelledby="heading18" data-parent="#controls"><div class="card-body">	<p>Create the mechanisms to ensure that sensitive data, such personal data or credentials is not uploaded to a repository. There are different ways to implement it. One of them is with the git pre-commit hooks, this way is described in the references.</p></div></div></div></div></div></div></div></div></div></div></div><div class="card border-danger"><div class="card-header " id="heading23"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse23" aria-expanded="true" aria-controls="collapse23">Threat: Authentication Bypass <span>[CAPEC-115]</span></button></h5></div><div id="collapse23" class="collapse" aria-labelledby="heading23" data-parent="#threats"><div class="card-body"><p>An attacker gains access to the application, service, or device with the privileges of an authorized or privileged user by evading - or circumventing - an authentication mechanism. The attacker is therefore able to access protected data without authentication ever having taken place. This refers to an attacker gaining access equivalent to an authenticated user without ever going through an authentication procedure. </p> This is usually the result of the attacker using an unexpected access procedure that does not go through the proper checkpoints where authentication should occur. For example, a web site might assume that all users will click through a given link in order to access secure material and simply authenticate everyone that clicks the link. However, an attacker might be able to reach secured web content by explicitly entering the path to the content rather than clicking through the authentication link, thereby avoiding the check entirely. This attack pattern differs from other authentication attacks in that attacks of this pattern avoid authentication entirely, rather than faking authentication by exploiting flaws or by stealing credentials from legitimate users.<div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading22"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse22" aria-expanded="true" aria-controls="collapse22">Weakness: Authentication Bypass Issues <span>[CWE-592]</span></button></h5></div><div id="collapse22" class="collapse" aria-labelledby="heading22" data-parent="#weaknesses"><div class="card-body">The software does not properly perform authentication, allowing 					it to be bypassed through various methods.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading21"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse21" aria-expanded="true" aria-controls="collapse21">Countermeasure: Ensure that the access control through API is centralized <span>[ACCESS-CONTROL-CENTRALIZED-AWS-LAMBDA]</span></button></h5></div><div id="collapse21" class="collapse" aria-labelledby="heading21" data-parent="#controls"><div class="card-body"><p>The access control, authentication and authorization procedures through API shall be centralized. To implement it into Lambda functions, we have got the two options:<br /></p> 
<ul> 
 <li>Lambda authorizers are Lambda functions that control access to REST API methods using bearer token authentication as well as information described by headers, paths, query strings, stage variables, or context variables request parameters.&nbsp;</li> 
 <ul> 
  <li>TOKEN type Lambda authorizers grant a caller permissions to invoke a given request using an authorization token passed in a header. The token could be, for example, an OAuth token.&nbsp;</li> 
  <li>REQUEST type Lambda authorizers grant a caller permissions to invoke a given request using request parameters, including headers, query strings, stage variables, or context parameters.</li> 
 </ul> 
 <li>Amazon Cognito user pools let you create customizable authentication and authorization solutions for your REST APIs.</li> 
</ul> 
<p></p> 
<p><b>Remediation:</b><br /> Create an API Gateway Lambda Authorizer Lambda Function:<br /></p> 
<ul> 
 <li>Before creating an API Gateway Lambda authorizer, you must first create the AWS Lambda function that implements the logic to authorize and, if necessary, to authenticate the caller. You can do so in the Lambda console, using the code template available from the API Gateway Lambda Authorizer blueprint.</li> 
 <li>To grant IAM principals in the account that owns the API permission to call authorizer:create or create-authorizer to control the Lambda function used in your Lambda authorizer, you can create the following IAM policy.</li> 
</ul> 
<blockquote> 
 <blockquote> 
  <blockquote>
    { 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &quot;Version&quot;: &quot;2012-10-17&quot;, 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &quot;Statement&quot;: [ 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; { 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;Effect&quot;: &quot;Allow&quot;, 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;Action&quot;: [ 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;apigateway:POST&quot; 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ], 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;Resource&quot;: [ 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;arn:aws:apigateway:region::/restapis/restapi_id/authorizers&quot; 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ], 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //Create Authorizer operation is allowed only with the following Lambda function 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;Condition&quot;: { 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;StringEquals&quot;: { 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;apigateway:AuthorizerUri&quot;: &quot;arn:aws:lambda:region:account-id:function:lambda-function-name&quot; 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; &nbsp; &nbsp; } 
  </blockquote> 
  <blockquote>
    &nbsp; &nbsp; ] 
  </blockquote> 
  <blockquote>
    } 
  </blockquote> 
 </blockquote> 
 <blockquote> 
 </blockquote> 
</blockquote> 
<div> 
 <p></p> 
 <p>Create a Lambda Function for a Lambda Authorizer of the TOKEN type<br /></p> 
 <ul> 
  <li>In the code editor of the Lambda console, enter the following Node.js code as an example of the API Gateway Lambda authorizer of the TOKEN type.</li> 
 </ul> 
 <p></p> 
</div> 
<blockquote> 
 <blockquote> 
  <div> 
   <p>// A simple TOKEN authorizer example to demonstrate how to use an authorization token&nbsp;</p> 
   <p>// to allow or deny a request. In this example, the caller named 'user' is allowed to invoke&nbsp;</p> 
   <p>// a request if the client-supplied token value is 'allow'. The caller is not allowed to invoke&nbsp;</p> 
   <p>// the request if the token value is 'deny'. If the token value is 'Unauthorized', the function&nbsp;</p> 
   <p>// returns the 'Unauthorized' error with an HTTP status code of 401. For any other token value,&nbsp;</p> 
   <p>// the authorizer returns an 'Invalid token' error.&nbsp;</p> 
   <p><br /></p> 
   <p>exports.handler =&nbsp; function(event, context, callback) {</p> 
   <p>&nbsp; &nbsp; var token = event.authorizationToken;</p> 
   <p>&nbsp; &nbsp; switch (token.toLowerCase()) {</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; case 'allow':</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callback(null, generatePolicy('user', 'Allow', event.methodArn));</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; case 'deny':</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callback(null, generatePolicy('user', 'Deny', event.methodArn));</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; case 'unauthorized':</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callback(&quot;Unauthorized&quot;);&nbsp; &nbsp;// Return a 401 Unauthorized response</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; default:</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; callback(&quot;Error: Invalid token&quot;);&nbsp;</p> 
   <p>&nbsp; &nbsp; }</p> 
   <p>};</p> 
   <p><br /></p> 
   <p>// Help function to generate an IAM policy</p> 
   <p>var generatePolicy = function(principalId, effect, resource) {</p> 
   <p>&nbsp; &nbsp; var authResponse = {};</p> 
   <p>&nbsp; &nbsp;&nbsp;</p> 
   <p>&nbsp; &nbsp; authResponse.principalId = principalId;</p> 
   <p>&nbsp; &nbsp; if (effect &amp;&amp; resource) {</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; var policyDocument = {};</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; policyDocument.Version = '2012-10-17';&nbsp;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; policyDocument.Statement = [];</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; var statementOne = {};</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; statementOne.Action = 'execute-api:Invoke';&nbsp;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; statementOne.Effect = effect;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; statementOne.Resource = resource;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; policyDocument.Statement[0] = statementOne;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; authResponse.policyDocument = policyDocument;</p> 
   <p>&nbsp; &nbsp; }</p> 
   <p>&nbsp; &nbsp;&nbsp;</p> 
   <p>&nbsp; &nbsp; // Optional output with custom properties of the String, Number or Boolean type.</p> 
   <p>&nbsp; &nbsp; authResponse.context = {</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &quot;stringKey&quot;: &quot;stringval&quot;,</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &quot;numberKey&quot;: 123,</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &quot;booleanKey&quot;: true</p> 
   <p>&nbsp; &nbsp; };</p> 
   <p>&nbsp; &nbsp; return authResponse;</p> 
   <p>}</p> 
  </div> 
 </blockquote> 
</blockquote> 
<blockquote> 
 <blockquote> 
 </blockquote> 
</blockquote> 
<div> 
 <p>Create a Lambda Function of a Lambda Authorizer of the REQUEST type<br /></p> 
 <ul> 
  <li>In the code editor of the Lambda console, enter the following Node.js code for a simplified Lambda function as an example of the API Gateway Lambda authorizers of the REQUEST type.</li> 
 </ul> 
 <p></p> 
</div> 
<blockquote> 
 <blockquote> 
  <div> 
   <p>exports.handler = function(event, context, callback) {&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p> 
   <p>&nbsp; &nbsp; console.log('Received event:', JSON.stringify(event, null, 2));</p> 
   <p><br /></p> 
   <p>&nbsp; &nbsp; // A simple REQUEST authorizer example to demonstrate how to use request&nbsp;</p> 
   <p>&nbsp; &nbsp; // parameters to allow or deny a request. In this example, a request is&nbsp;&nbsp;</p> 
   <p>&nbsp; &nbsp; // authorized if the client-supplied HeaderAuth1 header, QueryString1 query parameter,</p> 
   <p>&nbsp; &nbsp; // stage variable of StageVar1 and the accountId in the request context all match</p> 
   <p>&nbsp; &nbsp; // specified values of 'headerValue1', 'queryValue1', 'stageValue1', and</p> 
   <p>&nbsp; &nbsp; // '123456789012', respectively.</p> 
   <p><br /></p> 
   <p>&nbsp; &nbsp; // Retrieve request parameters from the Lambda function input:</p> 
   <p>&nbsp; &nbsp; var headers = event.headers;</p> 
   <p>&nbsp; &nbsp; var queryStringParameters = event.queryStringParameters;</p> 
   <p>&nbsp; &nbsp; var pathParameters = event.pathParameters;</p> 
   <p>&nbsp; &nbsp; var stageVariables = event.stageVariables;</p> 
   <p>&nbsp; &nbsp; var requestContext = event.requestContext;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p> 
   <p>&nbsp; &nbsp; // Parse the input for the parameter values</p> 
   <p>&nbsp; &nbsp; var tmp = event.methodArn.split(':');</p> 
   <p>&nbsp; &nbsp; var apiGatewayArnTmp = tmp[5].split('/');</p> 
   <p>&nbsp; &nbsp; var awsAccountId = tmp[4];</p> 
   <p>&nbsp; &nbsp; var region = tmp[3];</p> 
   <p>&nbsp; &nbsp; var restApiId = apiGatewayArnTmp[0];</p> 
   <p>&nbsp; &nbsp; var stage = apiGatewayArnTmp[1];</p> 
   <p>&nbsp; &nbsp; var method = apiGatewayArnTmp[2];</p> 
   <p>&nbsp; &nbsp; var resource = '/'; // root resource</p> 
   <p>&nbsp; &nbsp; if (apiGatewayArnTmp[3]) {</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; resource += apiGatewayArnTmp[3];</p> 
   <p>&nbsp; &nbsp; }</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p> 
   <p>&nbsp; &nbsp; // Perform authorization to return the Allow policy for correct parameters and&nbsp;</p> 
   <p>&nbsp; &nbsp; // the 'Unauthorized' error, otherwise.</p> 
   <p>&nbsp; &nbsp; var authResponse = {};</p> 
   <p>&nbsp; &nbsp; var condition = {};</p> 
   <p>&nbsp; &nbsp; condition.IpAddress = {};</p> 
   <p>&nbsp; &nbsp; &nbsp;</p> 
   <p>&nbsp; &nbsp; if (headers.HeaderAuth1 === &quot;headerValue1&quot;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; queryStringParameters.QueryString1 === &quot;queryValue1&quot;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; stageVariables.StageVar1 === &quot;stageValue1&quot;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; requestContext.accountId === &quot;123456789012&quot;) {</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; callback(null, generateAllow('me', event.methodArn));</p> 
   <p>&nbsp; &nbsp; }&nbsp; else {</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; callback(&quot;Unauthorized&quot;);</p> 
   <p>&nbsp; &nbsp; }</p> 
   <p>}</p> 
   <p>&nbsp; &nbsp; &nbsp;</p> 
   <p>// Help function to generate an IAM policy</p> 
   <p>var generatePolicy = function(principalId, effect, resource) {</p> 
   <p>&nbsp; &nbsp; // Required output:</p> 
   <p>&nbsp; &nbsp; var authResponse = {};</p> 
   <p>&nbsp; &nbsp; authResponse.principalId = principalId;</p> 
   <p>&nbsp; &nbsp; if (effect &amp;&amp; resource) {</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; var policyDocument = {};</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; policyDocument.Version = '2012-10-17'; // default version</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; policyDocument.Statement = [];</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; var statementOne = {};</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; statementOne.Action = 'execute-api:Invoke'; // default action</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; statementOne.Effect = effect;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; statementOne.Resource = resource;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; policyDocument.Statement[0] = statementOne;</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; authResponse.policyDocument = policyDocument;</p> 
   <p>&nbsp; &nbsp; }</p> 
   <p>&nbsp; &nbsp; // Optional output with custom properties of the String, Number or Boolean type.</p> 
   <p>&nbsp; &nbsp; authResponse.context = {</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &quot;stringKey&quot;: &quot;stringval&quot;,</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &quot;numberKey&quot;: 123,</p> 
   <p>&nbsp; &nbsp; &nbsp; &nbsp; &quot;booleanKey&quot;: true</p> 
   <p>&nbsp; &nbsp; };</p> 
   <p>&nbsp; &nbsp; return authResponse;</p> 
   <p>}</p> 
   <p>&nbsp; &nbsp; &nbsp;</p> 
   <p>var generateAllow = function(principalId, resource) {</p> 
   <p>&nbsp; &nbsp; return generatePolicy(principalId, 'Allow', resource);</p> 
   <p>}</p> 
   <p>&nbsp; &nbsp; &nbsp;</p> 
   <p>var generateDeny = function(principalId, resource) {</p> 
   <p>&nbsp; &nbsp; return generatePolicy(principalId, 'Deny', resource);</p> 
   <p>}</p> 
  </div> 
 </blockquote> 
</blockquote> 
<div> 
 <blockquote> 
  <blockquote> 
   <div> 
   </div> 
  </blockquote> 
 </blockquote> 
 <div> 
  <p>Amazon Cognito</p> 
  <p></p> 
  <ul> 
   <li>To create and configure an Amazon Cognito user pool for your API, you perform the following tasks:</li> 
   <ol> 
    <li>Use the Amazon Cognito console, CLI/SDK, or API to create a user pool—or use one that’s owned by another AWS account.</li> 
    <li>Use the API Gateway console, CLI/SDK, or API to create an API Gateway authorizer with the chosen user pool.</li> 
    <li>Use the API Gateway console, CLI/SDK, or API to enable the authorizer on selected API methods.</li> 
   </ol> 
   <li>To call any API methods with a user pool enabled, your API clients perform the following tasks:</li> 
   <ol> 
    <li>Use the Amazon Cognito CLI/SDK or API to sign a user in to the chosen user pool, and obtain an identity token or access token.</li> 
    <li>Use a client-specific framework to call the deployed API Gateway API and supply the appropriate token in the Authorization header.</li> 
   </ol> 
  </ul> 
  <p></p> 
 </div> 
</div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="card border-primary"><div class="card-header " id="heading38"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse38" aria-expanded="true" aria-controls="collapse38">Risk pattern: AWS Lambda: Authorization <span>[aws-lambda-authoritation]</span></button></h5></div><div id="collapse38" class="collapse" aria-labelledby="heading38" data-parent="#components"><div class="card-body"><div class="accordion" id="usecases"><div class="card border-black"><div class="card-header " id="heading37"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse37" aria-expanded="true" aria-controls="collapse37">Use case: Authorization <span>[AUTHORIZATION]</span></button></h5></div><div id="collapse37" class="collapse" aria-labelledby="heading37" data-parent="#usecases"><div class="card-body"><div class="accordion" id="threats"><div class="card border-danger"><div class="card-header " id="heading31"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse31" aria-expanded="true" aria-controls="collapse31">Threat: Privilege Abuse <span>[CAPEC-122]</span></button></h5></div><div id="collapse31" class="collapse" aria-labelledby="heading31" data-parent="#threats"><div class="card-body"><p>An adversary is able to exploit features of the target that should be reserved for privileged users or administrators but are exposed to use by lower or non-privileged accounts. Access to sensitive information and functionality must be controlled to ensure that only authorized users are able to access these resources. If access control mechanisms are absent or misconfigured, a user may be able to access resources that are intended only for higher level users. An adversary may be able to exploit this to utilize a less trusted account to gain information and perform activities reserved for more trusted accounts.&nbsp;</p> 
<p>This attack differs from privilege escalation and other privilege stealing attacks in that the adversary never actually escalates their privileges but instead is able to use a lesser degree of privilege to access resources that should be (but are not) reserved for higher privilege accounts. Likewise, the adversary does not exploit trust or subvert systems – all control functionality is working as configured but the configuration does not adequately protect sensitive resources at an appropriate level.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading30"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse30" aria-expanded="true" aria-controls="collapse30">Weakness: All Lambda functions have the same permissions <span>[AWS-LAMBDA-W10]</span></button></h5></div><div id="collapse30" class="collapse" aria-labelledby="heading30" data-parent="#weaknesses"><div class="card-body">Setting of permissions is done at the function level. Because there could be many functions, the job of configuring permissions on each one is all too often ignored or forgotten, leading to security weak spots.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading26"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse26" aria-expanded="true" aria-controls="collapse26">Countermeasure: Configure IAM Role statements on a per-function basis. <span>[AWS-LAMBDA-C12]</span></button></h5></div><div id="collapse26" class="collapse" aria-labelledby="heading26" data-parent="#controls"><div class="card-body"><p>You should spend time crafting suitable, minimal roles for each of your functions. This leverages the principle of least privilege. If you are using the API Gateway, you can also set Lambda authorizers. A Lambda function should do one specific task, so ensure the following model is followed: One function, one use case, one permission.&nbsp;</p> 
<p><b> Remediation: <br /></b> UsingAWSConsole: <br /></p> 
<ol> 
 <li>Login to theAWSManagement Console.&nbsp;</li> 
 <li>Navigate to the Lambda dashboard at https://console.aws.amazon.com/lambda/.&nbsp;</li> 
 <li>In the navigation panel, underAWSLambda section, choose Functions.&nbsp;</li> 
 <li>Choose the Lambda function that you want to examine then click on the function name to access its configuration page.&nbsp;</li> 
 <li>Select the Configuration tab then click the Execution role to expand the panel with theIAMrole that defines the permissions for the selected function.&nbsp;</li> 
 <li>Copy the name of theIAMexecution role currently available in the Existing role drop-down list.&nbsp;</li> 
 <li>Now navigate to theIAMdashboard at https://console.aws.amazon.com/iam/.&nbsp;</li> 
 <li>In the left navigation panel, choose Roles.&nbsp;</li> 
 <li>Paste the name of the execution role copied at step no. 6 in the Search box and press Enter.&nbsp;</li> 
 <li>Click on the AmazonIAMexecution role returned as the result.&nbsp;</li> 
 <li>On theIAMrole configuration page, select the Permissions tab from the bottom panel.&nbsp;</li> 
 <li>Click on the attachedIAMpolicy name available within Policy name column to access the policy document (JSONformat).&nbsp;</li> 
 <li>Include inside the {}JSONpanel, the policy document defined for the selectedIAMexecution role.&nbsp;</li> 
 <li>Add the Action and Resource elements&nbsp;</li> 
 <li>and their current values, if the element values are set to “*”&nbsp;</li> 
 <li>and the Effect is set to “Allow”,the selected Amazon Lambda function has admin privileges (we have to restrict the admin privileges in the Amazon Lambda function)&nbsp;</li> 
 <li>Repeat step no. 12 and 13 to add otherIAMpolicies attached to the selected execution role.&nbsp;</li> 
 <li>Repeat steps no. 4 – 16 to add theIAMexecution role permissions for other Amazon Lambda functions created within the current region.&nbsp;</li> 
 <li>Change theAWSregion from the navigation bar and repeat the process for the other regions.</li> 
</ol> 
<p></p></div></div></div><div class="card border-success"><div class="card-header " id="heading27"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse27" aria-expanded="true" aria-controls="collapse27">Countermeasure: Ensure it only exists one user to access to the API gateway <span>[AWS-LAMBDA-C16]</span></button></h5></div><div id="collapse27" class="collapse" aria-labelledby="heading27" data-parent="#controls"><div class="card-body"><p>The API gateway sits between the Lambda functions and the user. You must create an API gateway user that only has the ability to communicate with Lambda functions. It can only communicate between your internal perimeter. If the user is manipulated to send from a source other than theAPIgateway, access should be denied. You can also set Lambda authorizers in the API Gateway. </p> 
<p><b>Remediation: </b><br /> Configure the Lambda authorizers on API methods: <br /></p> 
<ol> 
 <li>Sign in to the API Gateway console.</li> 
 <li>Create an API method and choose Authorizers under that API.</li> 
 <li>Give the permissions to access to the Lambda Functions only to one user.</li> 
</ol> 
<p></p></div></div></div><div class="card border-success"><div class="card-header " id="heading28"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse28" aria-expanded="true" aria-controls="collapse28">Countermeasure: Enforce Least Privilege <span>[Hydras-AWS-IAM-2.7]</span></button></h5></div><div id="collapse28" class="collapse" aria-labelledby="heading28" data-parent="#controls"><div class="card-body"><p>Granting least privilege ensures that users only have the permissions required to complete their jobs rather than additional privileges that are not required. Following this model ensures that, should an account be compromised, the blast radius of damage is limited. </p> 
<p><b>Remediation:</b><br /> Allocate privileges via groups or roles via the recommendation in “Use RBAC with pre-defined policies added into groups or roles”.</p> 
<p>Content provided by Hydras IT LTD</p></div></div></div><div class="card border-success"><div class="card-header " id="heading29"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse29" aria-expanded="true" aria-controls="collapse29">Countermeasure: Apply RBAC with pre-defined policies added into groups or roles <span>[Hydras-AWS-IAM-2.8]</span></button></h5></div><div id="collapse29" class="collapse" aria-labelledby="heading29" data-parent="#controls"><div class="card-body"><p>Instead of defining permissions for individual IAM users, it’s usually more convenient to create groups that relate to job functions (administrators, developers, accounting, etc.), define the relevant permissions for each group, and then assign IAM users to those groups. All the users in an IAM group inherit the permissions assigned to the group. That way, you can make changes for everyone in a group in just one place. As people move around in your company, you can simply change what IAM group their IAM user belongs to. This method is know as Role Based Access Control (RBAC).</p> 
<p><b>Remediation:<br /></b> Remove privilege granted directly to a user: <br /></p> 
<ol> 
 <li>Sign in to the AWS Management Console (with IAM update privileges).</li> 
 <li>Go to IAM Service on the AWS Console.</li> 
 <li>Click on Users.</li> 
 <li>For each user complete the following:</li> 
 <ol> 
  <li>Select the user.</li> 
  <li>Click on the Permissions tab.</li> 
  <li>Expand “Managed Policies”.</li> 
  <li>Click “Detach Policy”.</li> 
  <li>Expand “Inline Policies”.</li> 
  <li>Click “Remove Policy”.</li> 
 </ol> 
</ol> 
<p></p> 
<p>Create a Group and add a user: <br /></p> 
<ol> 
 <li>Sign in to the AWS Management Console (with IAM update privileges).</li> 
 <li>Go to IAM Service on the AWS Console.</li> 
 <li>Select Groups and click Create New Group.</li> 
 <li>In the Group Name box, type the name of the group and click Next Step.</li> 
 <li>In the list of policies, select the check box for each policy that you want to apply to all members of the group. Click Next Step.</li> 
 <li>Click Create Group.</li> 
 <li>Click the new Group and select the “Users” tab.</li> 
 <li>Click “Add Users to Group”.</li> 
 <li>Select the users and click “Add Users”.</li> 
</ol> 
<p></p> 
<p>Content provided by Hydras IT LTD</p></div></div></div></div></div></div></div></div></div></div></div><div class="card border-danger"><div class="card-header " id="heading36"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse36" aria-expanded="true" aria-controls="collapse36">Threat: Privilege Escalation <span>[CAPEC-233]</span></button></h5></div><div id="collapse36" class="collapse" aria-labelledby="heading36" data-parent="#threats"><div class="card-body">	<p>An adversary exploits a weakness enabling them to elevate their privilege and perform an action that they are not supposed to be authorized to perform.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading35"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse35" aria-expanded="true" aria-controls="collapse35">Weakness: All Lambda functions have the same permissions <span>[AWS-LAMBDA-W10]</span></button></h5></div><div id="collapse35" class="collapse" aria-labelledby="heading35" data-parent="#weaknesses"><div class="card-body">Setting of permissions is done at the function level. Because there could be many functions, the job of configuring permissions on each one is all too often ignored or forgotten, leading to security weak spots.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading32"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse32" aria-expanded="true" aria-controls="collapse32">Countermeasure: Configure IAM Role statements on a per-function basis. <span>[AWS-LAMBDA-C12]</span></button></h5></div><div id="collapse32" class="collapse" aria-labelledby="heading32" data-parent="#controls"><div class="card-body"><p>You should spend time crafting suitable, minimal roles for each of your functions. This leverages the principle of least privilege. If you are using the API Gateway, you can also set Lambda authorizers. A Lambda function should do one specific task, so ensure the following model is followed: One function, one use case, one permission.&nbsp;</p> 
<p><b> Remediation: <br /></b> UsingAWSConsole: <br /></p> 
<ol> 
 <li>Login to theAWSManagement Console.&nbsp;</li> 
 <li>Navigate to the Lambda dashboard at https://console.aws.amazon.com/lambda/.&nbsp;</li> 
 <li>In the navigation panel, underAWSLambda section, choose Functions.&nbsp;</li> 
 <li>Choose the Lambda function that you want to examine then click on the function name to access its configuration page.&nbsp;</li> 
 <li>Select the Configuration tab then click the Execution role to expand the panel with theIAMrole that defines the permissions for the selected function.&nbsp;</li> 
 <li>Copy the name of theIAMexecution role currently available in the Existing role drop-down list.&nbsp;</li> 
 <li>Now navigate to theIAMdashboard at https://console.aws.amazon.com/iam/.&nbsp;</li> 
 <li>In the left navigation panel, choose Roles.&nbsp;</li> 
 <li>Paste the name of the execution role copied at step no. 6 in the Search box and press Enter.&nbsp;</li> 
 <li>Click on the AmazonIAMexecution role returned as the result.&nbsp;</li> 
 <li>On theIAMrole configuration page, select the Permissions tab from the bottom panel.&nbsp;</li> 
 <li>Click on the attachedIAMpolicy name available within Policy name column to access the policy document (JSONformat).&nbsp;</li> 
 <li>Include inside the {}JSONpanel, the policy document defined for the selectedIAMexecution role.&nbsp;</li> 
 <li>Add the Action and Resource elements&nbsp;</li> 
 <li>and their current values, if the element values are set to “*”&nbsp;</li> 
 <li>and the Effect is set to “Allow”,the selected Amazon Lambda function has admin privileges (we have to restrict the admin privileges in the Amazon Lambda function)&nbsp;</li> 
 <li>Repeat step no. 12 and 13 to add otherIAMpolicies attached to the selected execution role.&nbsp;</li> 
 <li>Repeat steps no. 4 – 16 to add theIAMexecution role permissions for other Amazon Lambda functions created within the current region.&nbsp;</li> 
 <li>Change theAWSregion from the navigation bar and repeat the process for the other regions.</li> 
</ol> 
<p></p></div></div></div><div class="card border-success"><div class="card-header " id="heading33"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse33" aria-expanded="true" aria-controls="collapse33">Countermeasure: Ensure that there is no user in production with the permission to delete permission on any service <span>[AWS-LAMBDA-C14]</span></button></h5></div><div id="collapse33" class="collapse" aria-labelledby="heading33" data-parent="#controls"><div class="card-body"><p>Ensure that there is no user in production that can delete services, functions and perhaps even data. This will ensure that nobody deletes items by accident. If delete actions are required in production, ensure that you have proper guidelines in place to prevent accidental deletion.</p> 
<p><b>Remediation:<br /></b> To view a function’s resource-based policy, use the get-policy command.<br /></p> 
<blockquote> 
 <p> aws lambda get-policy --function-name my-function --output text</p> 
</blockquote> 
<p>For versions and aliases, append the version number or alias to the function name.<br /></p> 
<blockquote> 
 <p> aws lambda get-policy --function-name my-function:PROD</p> 
</blockquote> 
<p>To remove permissions from your function, use remove-permission.<br /></p> 
<blockquote> 
 <p> aws lambda remove-permission --function-name example --statement-id sns</p> 
</blockquote> 
<p>Use the get-layer-version-policy command to view the permissions on a layer, and remove-layer-version-permission to remove statements from the policy.<br /></p> 
<blockquote> 
 <p> aws lambda get-layer-version-policy --layer-name my-layer --version-number 3 --output text</p> 
</blockquote> 
<blockquote> 
 <p>aws lambda remove-layer-version-permission --layer-name my-layer --version-number 3 --statement-id engineering-org</p> 
</blockquote></div></div></div><div class="card border-success"><div class="card-header " id="heading34"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse34" aria-expanded="true" aria-controls="collapse34">Countermeasure: Enforce Least Privilege <span>[Hydras-AWS-IAM-2.7]</span></button></h5></div><div id="collapse34" class="collapse" aria-labelledby="heading34" data-parent="#controls"><div class="card-body"><p>Granting least privilege ensures that users only have the permissions required to complete their jobs rather than additional privileges that are not required. Following this model ensures that, should an account be compromised, the blast radius of damage is limited. </p> 
<p><b>Remediation:</b><br /> Allocate privileges via groups or roles via the recommendation in “Use RBAC with pre-defined policies added into groups or roles”.</p> 
<p>Content provided by Hydras IT LTD</p></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="card border-primary"><div class="card-header " id="heading67"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse67" aria-expanded="true" aria-controls="collapse67">Risk pattern: AWS Lambda: Denial-of-Service / Wallet <span>[aws-lambda-denial-of-service]</span></button></h5></div><div id="collapse67" class="collapse" aria-labelledby="heading67" data-parent="#components"><div class="card-body"><div class="accordion" id="usecases"><div class="card border-black"><div class="card-header " id="heading66"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse66" aria-expanded="true" aria-controls="collapse66">Use case: General <span>[GENERAL]</span></button></h5></div><div id="collapse66" class="collapse" aria-labelledby="heading66" data-parent="#usecases"><div class="card-body"><div class="accordion" id="threats"><div class="card border-danger"><div class="card-header " id="heading47"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse47" aria-expanded="true" aria-controls="collapse47">Threat: Attackers force to increase the Amazon billing through overloading the resources <span>[AWS-LAMBDA-T12]</span></button></h5></div><div id="collapse47" class="collapse" aria-labelledby="heading47" data-parent="#threats"><div class="card-body">	<p>One of the principles of Lambda functions is that you pay for the amount of time your code is running. This pushes the developer to write efficient code. Efficient code should also be limited in execution time. An attacker could try to force services to overload resources and push the boundaries.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading43"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse43" aria-expanded="true" aria-controls="collapse43">Weakness: Functions don’t have a rate limit or aren’t throttled <span>[AWS-LAMBDA-W16]</span></button></h5></div><div id="collapse43" class="collapse" aria-labelledby="heading43" data-parent="#weaknesses"><div class="card-body">An attacker can try to freeze the system with huge amounts of requests. 
 If your concurrency limits are set and high, an attacker can still execute a lot of requests and it will cost you a lot of money. It's important to set some limits on services or functions.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading39"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse39" aria-expanded="true" aria-controls="collapse39">Countermeasure: Set a concurrency limits for your functions <span>[AWS-LAMBDA-C22]</span></button></h5></div><div id="collapse39" class="collapse" aria-labelledby="heading39" data-parent="#controls"><div class="card-body"><p>Lambda provides a concurrent execution limit control at both the account level and the function level. By default, AWS Lambda limits the total concurrent executions across all functions within a given region to 1000. The function level concurrent execution limit is by default enforced against the sum of the concurrent executions of all functions.</p> 
<p><b>Remediation:<br /></b> To set a concurrency limit for your Lambda function using the AWS CLI, do the following:<br /></p> 
<ul> 
 <li>Use the PutFunctionConcurrency operation and pass in the function name and concurrency limit you want allocated to this function:</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p> aws lambda put-function-concurrency --function-name function-name --reserved-concurrent-executions limit value</p> 
 </blockquote> 
</blockquote></div></div></div><div class="card border-success"><div class="card-header " id="heading40"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse40" aria-expanded="true" aria-controls="collapse40">Countermeasure: Use the API gateway Plans to throttle incoming API calls or rate limit the requests <span>[AWS-LAMBDA-C24]</span></button></h5></div><div id="collapse40" class="collapse" aria-labelledby="heading40" data-parent="#controls"><div class="card-body"><p>Throttling or rate limiting will limit the rate of transactions passing through the API Gateway. When limits are exceeded the API gateway will respond with a HTTP response error code. There are several possibilities to set throttling but the use of an API key and usage plan is a best practice.</p> 
<p><b>Remediation:</b><br /></p> 
<ol> 
 <li>In the Amazon API Gateway main navigation pane, choose Usage Plans, and then choose Create.</li> 
 <li>Under Create Usage Plan, do the following:</li> 
 <ol> 
  <li>For Name, type a name for your plan (for example, Plan_A).</li> 
  <li>For Description, type a description for your plan.&nbsp;</li> 
  <li>Select Enable throttling, and set Rate (for example, 100) and Burst (for example, 200).</li> 
  <li>Choose Enable quota, and set its limit (for example, 5000) for a selected time interval (for example, Month).</li> 
 </ol> 
 <li>To add a stage to the plan, do the following in the Associated API Stages pane:</li> 
 <ol> 
  <li>Choose Add API Stage.</li> 
  <li>Choose an API (for example, PetStore) from the API drop-down list.</li> 
  <li>Choose a stage (for example, Stage_1) from the Stage drop-down list.</li> 
  <li>Choose the checkmark icon to save.</li> 
 </ol> 
 <li>To configure method throttling, do the following:</li> 
 <ol> 
  <li>Choose Configure Method Throttling.</li> 
  <li>Choose Add Resource/Method.</li> 
  <li>Choose the resource from the Resource drop-down menu.</li> 
  <li>Choose the method from the Method drop-down menu.</li> 
  <li>Set Rate (requests per second) (for example, 100) and Burst (for example, 200).</li> 
  <li>Choose the checkmark icon to save.</li> 
  <li>Choose Close.</li> 
 </ol> 
 <li>To add a key to the plan, do the following in the API Keys tab:</li> 
 <ol> 
  <li>To use an existing key, choose Add API Key to Usage Plan.</li> 
  <li>For Name, type a name for the key you want to add (for example, MyFirstKey).</li> 
  <li>Choose the checkmark icon to save.</li> 
 </ol> 
</ol> 
<p></p> 
<p>As needed, repeat the preceding steps to add other existing API keys to this usage plan.</p></div></div></div><div class="card border-success"><div class="card-header " id="heading41"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse41" aria-expanded="true" aria-controls="collapse41">Countermeasure: Set time-outs on invocations of functions <span>[AWS-LAMBDA-C25]</span></button></h5></div><div id="collapse41" class="collapse" aria-labelledby="heading41" data-parent="#controls"><div class="card-body"><p>To prevent your Lambda function from running indefinitely, you specify a timeout. You shall set this value based on your expected execution time. The default for functions created in the console is 3 seconds. To ensure that you write clean code also verify that the termination criteria are met every time to prevent endless or long invocations.</p> 
<p><b>Remediation:<br /></b></p> 
<ul> 
 <li>Update the timeout of your functions using the following AWS CLI command:</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p>aws lambda update-function-configuration --function-name myfunction --timeout 3</p> 
 </blockquote> 
</blockquote> 
<p></p> 
<ul> 
 <li>In the example, we change the timeout limit to 3 seconds</li> 
</ul> 
<p></p></div></div></div><div class="card border-success"><div class="card-header " id="heading42"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse42" aria-expanded="true" aria-controls="collapse42">Countermeasure: Configurate the retry settings of asynchronous sources <span>[AWS-LAMBDA-C26]</span></button></h5></div><div id="collapse42" class="collapse" aria-labelledby="heading42" data-parent="#controls"><div class="card-body"><p>Any Lambda function invoked asynchronously is retried twice before the event is discarded. If the retries fail and you’re unsure why, use Dead Letter Queues (DLQ) to direct unprocessed events to an Amazon SQS queue or an Amazon SNS topic to analyze the failure.</p> 
<p>AWS Lambda directs events that cannot be processed to the specified Amazon SNS topic or Amazon SQS queue. Functions that don’t specify a DLQ will discard events after they have exhausted their retries. For more information about retry policies, see AWS Lambda Retry Behavior.</p> 
<p>You configure a DLQ by specifying the Amazon Resource Name TargetArn value on the Lambda function’s DeadLetterConfig parameter.</p> 
<p><b>Remediation:<br /></b> Update the timeout of your functions using the following AWS CLI command:<br /></p> 
<blockquote> 
 <p> aws lambda update-function-configuration --function-name myfunction --dead-letter-config (structure)</p> 
</blockquote> 
<p>A dead letter queue configuration that specifies the queue or topic where Lambda sends asynchronous events when they fail processing. For more information, see Dead Letter Queues in the references.<br /></p> 
<blockquote> 
 <p> Shorthand Syntax:</p> 
 <p> TargetArn=string</p> 
 <p> JSON Syntax:</p> 
 <p>{ “TargetArn”: “string”</p> 
 <p> }</p> 
</blockquote></div></div></div></div></div></div></div><div class="card border-warning"><div class="card-header " id="heading46"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse46" aria-expanded="true" aria-controls="collapse46">Weakness: No validation for asynchronous events <span>[AWS-LAMBDA-W19]</span></button></h5></div><div id="collapse46" class="collapse" aria-labelledby="heading46" data-parent="#weaknesses"><div class="card-body">Lambda can handle several different event types that can trigger a serverless function. These event types don't necessarily need to be HTTP requests (e.g. S3, SNS, SES, CloudWatch Events, etc.). This increases the potential attack surface and introduces complexities to secure the serverless functions.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading44"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse44" aria-expanded="true" aria-controls="collapse44">Countermeasure: Enable and set up Request Validation in API Gateway <span>[AWS-LAMBDA-C11]</span></button></h5></div><div id="collapse44" class="collapse" aria-labelledby="heading44" data-parent="#controls"><div class="card-body"><p>To perform the API Gateway basic validation, we have to enable and set up the Request Validation in the API Gateway.</p> 
<p><b>Remediation:<br /></b> To enable basic validation, you specify validation rules in a request validator, add the validator to the API’s map of request validators, and assign the validator to individual API methods.</p> 
<p>To set up a basic validation, we have some possibilities to configure it:<br /></p> 
<ul> 
 <li>by Importing OpenAPI Definition</li> 
 <li>using the API Gateway REST API</li> 
 <li>using the API Gateway Console</li> 
</ul> 
<p></p> 
<p>Using the API Gateway Console:<br /></p> 
<ul> 
 <li>The API Gateway console lets you set up the basic request validation on a method using one of the three validators:</li> 
 <ul> 
  <li>Validate body: This is the body-only validator.</li> 
  <li>Validate query string parameters and headers: This is the parameters-only validator.</li> 
  <li>Validate body, query string parameters, and headers: This validator is for both body and parameters validation.</li> 
 </ul> 
 <li>When you choose one of the above validators to enable it on an API method, the API Gateway console will add the validator to the API’s RequestValidators map, if the validator has not already been added to the validators map of the API. To enable a request validator on a method:</li> 
 <ol> 
  <li>Sign in to the API Gateway console, if not already logged in.</li> 
  <li>Create a new or choose an existing API.</li> 
  <li>Create a new or choose an existing resource of the API.</li> 
  <li>Create a new or choose an existing method the resource.</li> 
  <li>Choose Method Request.</li> 
  <li>Choose the pencil icon of Request Validator under Settings.</li> 
  <li>Choose Validate body, Validate query string parameters and headers or Validate body, query string parameters, and headers from the Request Validator drop-down list and then choose the check mark icon to save your choice.</li> 
 </ol> 
</ul> 
<p></p> 
<p>For more information see the references.</p></div></div></div><div class="card border-success"><div class="card-header " id="heading45"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse45" aria-expanded="true" aria-controls="collapse45">Countermeasure: Configurate the retry settings of asynchronous sources <span>[AWS-LAMBDA-C26]</span></button></h5></div><div id="collapse45" class="collapse" aria-labelledby="heading45" data-parent="#controls"><div class="card-body"><p>Any Lambda function invoked asynchronously is retried twice before the event is discarded. If the retries fail and you’re unsure why, use Dead Letter Queues (DLQ) to direct unprocessed events to an Amazon SQS queue or an Amazon SNS topic to analyze the failure.</p> 
<p>AWS Lambda directs events that cannot be processed to the specified Amazon SNS topic or Amazon SQS queue. Functions that don’t specify a DLQ will discard events after they have exhausted their retries. For more information about retry policies, see AWS Lambda Retry Behavior.</p> 
<p>You configure a DLQ by specifying the Amazon Resource Name TargetArn value on the Lambda function’s DeadLetterConfig parameter.</p> 
<p><b>Remediation:<br /></b> Update the timeout of your functions using the following AWS CLI command:<br /></p> 
<blockquote> 
 <p> aws lambda update-function-configuration --function-name myfunction --dead-letter-config (structure)</p> 
</blockquote> 
<p>A dead letter queue configuration that specifies the queue or topic where Lambda sends asynchronous events when they fail processing. For more information, see Dead Letter Queues in the references.<br /></p> 
<blockquote> 
 <p> Shorthand Syntax:</p> 
 <p> TargetArn=string</p> 
 <p> JSON Syntax:</p> 
 <p>{ “TargetArn”: “string”</p> 
 <p> }</p> 
</blockquote></div></div></div></div></div></div></div></div></div></div></div><div class="card border-danger"><div class="card-header " id="heading65"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse65" aria-expanded="true" aria-controls="collapse65">Threat: Excessive Allocation <span>[CAPEC-130]</span></button></h5></div><div id="collapse65" class="collapse" aria-labelledby="heading65" data-parent="#threats"><div class="card-body"><p>An adversary causes the target to allocate excessive resources to servicing the attackers’ request, thereby reducing the resources available for legitimate services and degrading or denying services. Usually, this attack focuses on memory allocation, but any finite resource on the target could be the attacked, including bandwidth, processing cycles, or other resources.&nbsp;</p> 
<p>This attack does not attempt to force this allocation through a large number of requests (that would be Resource Depletion through Flooding) but instead uses one or a small number of requests that are carefully formatted to force the target to allocate excessive resources to service this request(s). Often this attack takes advantage of a bug in the target to cause the target to allocate resources vastly beyond what would be needed for a normal request.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading50"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse50" aria-expanded="true" aria-controls="collapse50">Weakness: AWS VPC IP address depletion <span>[AWS-VPC-IP-ADDRESS-DEPLETION-WEAKNESS]</span></button></h5></div><div id="collapse50" class="collapse" aria-labelledby="heading50" data-parent="#weaknesses"><div class="card-body">Organizations that deploy AWS Lambda functions in VPC (Virtual Private Cloud) environments should also pay attention to the potential exhaustion of IP addresses in the VPC subnet.  
 An attacker might cause a denial of service scenario by forcing more and more function instances to execute, and deplete the VPC subnet from available IP addresses.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading48"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse48" aria-expanded="true" aria-controls="collapse48">Countermeasure: Ensure that your VPC Lambda subnet has enough IP addresses to scale <span>[AWS-LAMBDA-IP-ADDRESSES-VPC]</span></button></h5></div><div id="collapse48" class="collapse" aria-labelledby="heading48" data-parent="#controls"><div class="card-body"><p>The subnets you specify should have sufficient available IP addresses to match the number of ENIs. If your VPC does not have sufficient ENIs or subnet IPs, your Lambda function will not scale as requests increase, and you will see an increase in invocation errors with EC2 error types like EC2ThrottledException. For asynchronous invocation, if you see an increase in errors without corresponding CloudWatch Logs, invoke the Lambda function synchronously in the console to get the error responses. </p> 
<p><b>Remediation:<br /></b> Review each function and verify that each function has got at least one associated subnet Id with the following command:<br /></p> 
<blockquote> 
 <p> aws lambda get-function --function-name </p> 
</blockquote> 
<p>If there is any function without associated Subnet Id, we can update the function and assign a subnet with the following command:<br /></p> 
<blockquote> 
 <p> aws lambda update-function-configuration --function-name --vpc-config </p> 
</blockquote> 
<p>For network connectivity to AWS resources in a VPC, specify a list of security groups and subnets in the VPC. When you connect a function to a VPC, it can only access resources and the internet through that VPC. For more information, see VPC Settings .<br /></p> 
<blockquote> 
 <p> Shorthand Syntax:</p> 
 <p>SubnetIds=string,string,SecurityGroupIds=string,string</p> 
 <p> JSON Syntax:</p> 
 <p>{ “SubnetIds”: [“string”, …], “SecurityGroupIds”: [“string”, …]</p> 
 <p> }</p> 
</blockquote></div></div></div><div class="card border-success"><div class="card-header " id="heading49"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse49" aria-expanded="true" aria-controls="collapse49">Countermeasure: Ensure that each Lambda Function has got at least one VPC subnet in each Availability Zone <span>[AWS-LAMBDA-SUBNET-AVAILABILITY-ZONE]</span></button></h5></div><div id="collapse49" class="collapse" aria-labelledby="heading49" data-parent="#controls"><div class="card-body"><p>By specifying subnets in each of the Availability Zones, your Lambda function can run in another Availability Zone if one goes down or runs out of IP addresses.</p> 
<p><b>Remediation:<br /></b> Review each function and verify that each function has got at least one associated subnet Id in different Availability Zone with the following command:</p> 
<blockquote> 
 <p>aws lambda get-function --function-name</p> 
</blockquote> 
<p>If there is any function without associated Subnet Id per Availability Zone, we can update the Lambda function and assign a subnet from a specific Availability Zone with the following command:<br /></p> 
<blockquote> 
 <p> aws lambda update-function-configuration --function-name --vpc-config </p> 
</blockquote> 
<p>For network connectivity to AWS resources in a VPC, specify a list of security groups and subnets in the VPC. When you connect a function to a VPC, it can only access resources and the internet through that VPC. For more information, see VPC Settings .<br /></p> 
<blockquote> 
 <p> Shorthand Syntax:</p> 
 <p>SubnetIds=string,string,SecurityGroupIds=string,string</p> 
 <p> JSON Syntax:</p> 
 <p>{ “SubnetIds”: [“string”, …], “SecurityGroupIds”: [“string”, …]</p> 
 <p> }</p> 
</blockquote></div></div></div></div></div></div></div><div class="card border-warning"><div class="card-header " id="heading53"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse53" aria-expanded="true" aria-controls="collapse53">Weakness: Functions consume too much memory <span>[AWS-LAMBDA-W15]</span></button></h5></div><div id="collapse53" class="collapse" aria-labelledby="heading53" data-parent="#weaknesses"><div class="card-body">Default limits and poor configuration can lead to successful DDoS attacks.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading51"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse51" aria-expanded="true" aria-controls="collapse51">Countermeasure: Change the default memory usage to the amount of memory the function really needs <span>[AWS-LAMBDA-C20]</span></button></h5></div><div id="collapse51" class="collapse" aria-labelledby="heading51" data-parent="#controls"><div class="card-body"><p>Specify the amount of memory you want to allocate for your Lambda function. CloudWatch logs can contain memory usage on each function execution. Set the default memory usage to the amount of memory that the function really needs. By default, it set to of 1024 MB.</p> 
<p><b>Remediation:<br /></b> Update the memory size of your functions using the following AWS CLI command:<br /></p> 
<blockquote> 
 <p> aws lambda update-function-configuration --function-name myfunction --memory-size 256</p> 
</blockquote> 
<p>In the example, we change the amount memory for the function to 256 MB.</p></div></div></div><div class="card border-success"><div class="card-header " id="heading52"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse52" aria-expanded="true" aria-controls="collapse52">Countermeasure: Use a profiler tool to improve the application <span>[AWS-LAMBDA-C23]</span></button></h5></div><div id="collapse52" class="collapse" aria-labelledby="heading52" data-parent="#controls"><div class="card-body">	<p>When using a profiler tool, the execution of your functions are monitored. It will reveal which functions are called, number of invocations, execution times, memory usage and CPU use.</p>

	<p>You can use it to find and identify bottlenecks and address them. Therefore, you shall use a profiler tool to improve the time of use, memory usage and CPU usage of the function.</p></div></div></div></div></div></div></div><div class="card border-warning"><div class="card-header " id="heading58"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse58" aria-expanded="true" aria-controls="collapse58">Weakness: Functions don’t have a rate limit or aren’t throttled <span>[AWS-LAMBDA-W16]</span></button></h5></div><div id="collapse58" class="collapse" aria-labelledby="heading58" data-parent="#weaknesses"><div class="card-body">An attacker can try to freeze the system with huge amounts of requests. 
 If your concurrency limits are set and high, an attacker can still execute a lot of requests and it will cost you a lot of money. It's important to set some limits on services or functions.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading54"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse54" aria-expanded="true" aria-controls="collapse54">Countermeasure: Set a concurrency limits for your functions <span>[AWS-LAMBDA-C22]</span></button></h5></div><div id="collapse54" class="collapse" aria-labelledby="heading54" data-parent="#controls"><div class="card-body"><p>Lambda provides a concurrent execution limit control at both the account level and the function level. By default, AWS Lambda limits the total concurrent executions across all functions within a given region to 1000. The function level concurrent execution limit is by default enforced against the sum of the concurrent executions of all functions.</p> 
<p><b>Remediation:<br /></b> To set a concurrency limit for your Lambda function using the AWS CLI, do the following:<br /></p> 
<ul> 
 <li>Use the PutFunctionConcurrency operation and pass in the function name and concurrency limit you want allocated to this function:</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p> aws lambda put-function-concurrency --function-name function-name --reserved-concurrent-executions limit value</p> 
 </blockquote> 
</blockquote></div></div></div><div class="card border-success"><div class="card-header " id="heading55"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse55" aria-expanded="true" aria-controls="collapse55">Countermeasure: Use the API gateway Plans to throttle incoming API calls or rate limit the requests <span>[AWS-LAMBDA-C24]</span></button></h5></div><div id="collapse55" class="collapse" aria-labelledby="heading55" data-parent="#controls"><div class="card-body"><p>Throttling or rate limiting will limit the rate of transactions passing through the API Gateway. When limits are exceeded the API gateway will respond with a HTTP response error code. There are several possibilities to set throttling but the use of an API key and usage plan is a best practice.</p> 
<p><b>Remediation:</b><br /></p> 
<ol> 
 <li>In the Amazon API Gateway main navigation pane, choose Usage Plans, and then choose Create.</li> 
 <li>Under Create Usage Plan, do the following:</li> 
 <ol> 
  <li>For Name, type a name for your plan (for example, Plan_A).</li> 
  <li>For Description, type a description for your plan.&nbsp;</li> 
  <li>Select Enable throttling, and set Rate (for example, 100) and Burst (for example, 200).</li> 
  <li>Choose Enable quota, and set its limit (for example, 5000) for a selected time interval (for example, Month).</li> 
 </ol> 
 <li>To add a stage to the plan, do the following in the Associated API Stages pane:</li> 
 <ol> 
  <li>Choose Add API Stage.</li> 
  <li>Choose an API (for example, PetStore) from the API drop-down list.</li> 
  <li>Choose a stage (for example, Stage_1) from the Stage drop-down list.</li> 
  <li>Choose the checkmark icon to save.</li> 
 </ol> 
 <li>To configure method throttling, do the following:</li> 
 <ol> 
  <li>Choose Configure Method Throttling.</li> 
  <li>Choose Add Resource/Method.</li> 
  <li>Choose the resource from the Resource drop-down menu.</li> 
  <li>Choose the method from the Method drop-down menu.</li> 
  <li>Set Rate (requests per second) (for example, 100) and Burst (for example, 200).</li> 
  <li>Choose the checkmark icon to save.</li> 
  <li>Choose Close.</li> 
 </ol> 
 <li>To add a key to the plan, do the following in the API Keys tab:</li> 
 <ol> 
  <li>To use an existing key, choose Add API Key to Usage Plan.</li> 
  <li>For Name, type a name for the key you want to add (for example, MyFirstKey).</li> 
  <li>Choose the checkmark icon to save.</li> 
 </ol> 
</ol> 
<p></p> 
<p>As needed, repeat the preceding steps to add other existing API keys to this usage plan.</p></div></div></div><div class="card border-success"><div class="card-header " id="heading56"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse56" aria-expanded="true" aria-controls="collapse56">Countermeasure: Set time-outs on invocations of functions <span>[AWS-LAMBDA-C25]</span></button></h5></div><div id="collapse56" class="collapse" aria-labelledby="heading56" data-parent="#controls"><div class="card-body"><p>To prevent your Lambda function from running indefinitely, you specify a timeout. You shall set this value based on your expected execution time. The default for functions created in the console is 3 seconds. To ensure that you write clean code also verify that the termination criteria are met every time to prevent endless or long invocations.</p> 
<p><b>Remediation:<br /></b></p> 
<ul> 
 <li>Update the timeout of your functions using the following AWS CLI command:</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p>aws lambda update-function-configuration --function-name myfunction --timeout 3</p> 
 </blockquote> 
</blockquote> 
<p></p> 
<ul> 
 <li>In the example, we change the timeout limit to 3 seconds</li> 
</ul> 
<p></p></div></div></div><div class="card border-success"><div class="card-header " id="heading57"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse57" aria-expanded="true" aria-controls="collapse57">Countermeasure: Configurate the retry settings of asynchronous sources <span>[AWS-LAMBDA-C26]</span></button></h5></div><div id="collapse57" class="collapse" aria-labelledby="heading57" data-parent="#controls"><div class="card-body"><p>Any Lambda function invoked asynchronously is retried twice before the event is discarded. If the retries fail and you’re unsure why, use Dead Letter Queues (DLQ) to direct unprocessed events to an Amazon SQS queue or an Amazon SNS topic to analyze the failure.</p> 
<p>AWS Lambda directs events that cannot be processed to the specified Amazon SNS topic or Amazon SQS queue. Functions that don’t specify a DLQ will discard events after they have exhausted their retries. For more information about retry policies, see AWS Lambda Retry Behavior.</p> 
<p>You configure a DLQ by specifying the Amazon Resource Name TargetArn value on the Lambda function’s DeadLetterConfig parameter.</p> 
<p><b>Remediation:<br /></b> Update the timeout of your functions using the following AWS CLI command:<br /></p> 
<blockquote> 
 <p> aws lambda update-function-configuration --function-name myfunction --dead-letter-config (structure)</p> 
</blockquote> 
<p>A dead letter queue configuration that specifies the queue or topic where Lambda sends asynchronous events when they fail processing. For more information, see Dead Letter Queues in the references.<br /></p> 
<blockquote> 
 <p> Shorthand Syntax:</p> 
 <p> TargetArn=string</p> 
 <p> JSON Syntax:</p> 
 <p>{ “TargetArn”: “string”</p> 
 <p> }</p> 
</blockquote></div></div></div></div></div></div></div><div class="card border-warning"><div class="card-header " id="heading60"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse60" aria-expanded="true" aria-controls="collapse60">Weakness: Functions have poor concurrency limits <span>[AWS-LAMBDA-W14]</span></button></h5></div><div id="collapse60" class="collapse" aria-labelledby="heading60" data-parent="#weaknesses"><div class="card-body">If your concurrency limits are too small, scaling will not be as flexible as you would like. If your concurrency limits are too high, DoS could be a problem.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading59"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse59" aria-expanded="true" aria-controls="collapse59">Countermeasure: Set a concurrency limits for your functions <span>[AWS-LAMBDA-C22]</span></button></h5></div><div id="collapse59" class="collapse" aria-labelledby="heading59" data-parent="#controls"><div class="card-body"><p>Lambda provides a concurrent execution limit control at both the account level and the function level. By default, AWS Lambda limits the total concurrent executions across all functions within a given region to 1000. The function level concurrent execution limit is by default enforced against the sum of the concurrent executions of all functions.</p> 
<p><b>Remediation:<br /></b> To set a concurrency limit for your Lambda function using the AWS CLI, do the following:<br /></p> 
<ul> 
 <li>Use the PutFunctionConcurrency operation and pass in the function name and concurrency limit you want allocated to this function:</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p> aws lambda put-function-concurrency --function-name function-name --reserved-concurrent-executions limit value</p> 
 </blockquote> 
</blockquote></div></div></div></div></div></div></div><div class="card border-warning"><div class="card-header " id="heading62"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse62" aria-expanded="true" aria-controls="collapse62">Weakness: Functions take too long to execute <span>[AWS-LAMBDA-W17]</span></button></h5></div><div id="collapse62" class="collapse" aria-labelledby="heading62" data-parent="#weaknesses"><div class="card-body">The function is taken too long to execute. This could be because the function is doing too much or recursive patterns are used.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading61"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse61" aria-expanded="true" aria-controls="collapse61">Countermeasure: Set time-outs on invocations of functions <span>[AWS-LAMBDA-C25]</span></button></h5></div><div id="collapse61" class="collapse" aria-labelledby="heading61" data-parent="#controls"><div class="card-body"><p>To prevent your Lambda function from running indefinitely, you specify a timeout. You shall set this value based on your expected execution time. The default for functions created in the console is 3 seconds. To ensure that you write clean code also verify that the termination criteria are met every time to prevent endless or long invocations.</p> 
<p><b>Remediation:<br /></b></p> 
<ul> 
 <li>Update the timeout of your functions using the following AWS CLI command:</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p>aws lambda update-function-configuration --function-name myfunction --timeout 3</p> 
 </blockquote> 
</blockquote> 
<p></p> 
<ul> 
 <li>In the example, we change the timeout limit to 3 seconds</li> 
</ul> 
<p></p></div></div></div></div></div></div></div><div class="card border-warning"><div class="card-header " id="heading64"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse64" aria-expanded="true" aria-controls="collapse64">Weakness: The retry mechanism of asynchronous sources are not configured correctly <span>[AWS-LAMBDA-W18]</span></button></h5></div><div id="collapse64" class="collapse" aria-labelledby="heading64" data-parent="#weaknesses"><div class="card-body">Asynchronous events (e.g. S3, SNS, SES, CloudWatch Events, etc.) uses queues before invoking, so retry behavior must be taken in account.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading63"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse63" aria-expanded="true" aria-controls="collapse63">Countermeasure: Configurate the retry settings of asynchronous sources <span>[AWS-LAMBDA-C26]</span></button></h5></div><div id="collapse63" class="collapse" aria-labelledby="heading63" data-parent="#controls"><div class="card-body"><p>Any Lambda function invoked asynchronously is retried twice before the event is discarded. If the retries fail and you’re unsure why, use Dead Letter Queues (DLQ) to direct unprocessed events to an Amazon SQS queue or an Amazon SNS topic to analyze the failure.</p> 
<p>AWS Lambda directs events that cannot be processed to the specified Amazon SNS topic or Amazon SQS queue. Functions that don’t specify a DLQ will discard events after they have exhausted their retries. For more information about retry policies, see AWS Lambda Retry Behavior.</p> 
<p>You configure a DLQ by specifying the Amazon Resource Name TargetArn value on the Lambda function’s DeadLetterConfig parameter.</p> 
<p><b>Remediation:<br /></b> Update the timeout of your functions using the following AWS CLI command:<br /></p> 
<blockquote> 
 <p> aws lambda update-function-configuration --function-name myfunction --dead-letter-config (structure)</p> 
</blockquote> 
<p>A dead letter queue configuration that specifies the queue or topic where Lambda sends asynchronous events when they fail processing. For more information, see Dead Letter Queues in the references.<br /></p> 
<blockquote> 
 <p> Shorthand Syntax:</p> 
 <p> TargetArn=string</p> 
 <p> JSON Syntax:</p> 
 <p>{ “TargetArn”: “string”</p> 
 <p> }</p> 
</blockquote></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="card border-primary"><div class="card-header " id="heading73"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse73" aria-expanded="true" aria-controls="collapse73">Risk pattern: AWS Lambda: Flow management <span>[aws-lambda-flow-management]</span></button></h5></div><div id="collapse73" class="collapse" aria-labelledby="heading73" data-parent="#components"><div class="card-body"><div class="accordion" id="usecases"><div class="card border-black"><div class="card-header " id="heading72"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse72" aria-expanded="true" aria-controls="collapse72">Use case: General <span>[GENERAL]</span></button></h5></div><div id="collapse72" class="collapse" aria-labelledby="heading72" data-parent="#usecases"><div class="card-body"><div class="accordion" id="threats"><div class="card border-danger"><div class="card-header " id="heading71"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse71" aria-expanded="true" aria-controls="collapse71">Threat: Attackers subvert the intended workflow of the application in order to perform unauthorised operations <span>[CAPEC-172]</span></button></h5></div><div id="collapse71" class="collapse" aria-labelledby="heading71" data-parent="#threats"><div class="card-body">	<p>If an application enforces an order in workflows, then attackers could attempt to bypass this order so that they can perform operations for which they are not authorized. The technique can also be used to gain access to unauthorised data.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading70"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse70" aria-expanded="true" aria-controls="collapse70">Weakness: Improper Enforcement of Behavioral Workflow <span>[CWE-841]</span></button></h5></div><div id="collapse70" class="collapse" aria-labelledby="heading70" data-parent="#weaknesses"><div class="card-body">The software supports a session in which more than one behavior must be performed by an actor, but it does not properly ensure that the actor performs the behaviors in the required sequence.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading68"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse68" aria-expanded="true" aria-controls="collapse68">Countermeasure: Detect and notify the usage of automated tools or unusual behavior <span>[OTG-BUSLOGIC]</span></button></h5></div><div id="collapse68" class="collapse" aria-labelledby="heading68" data-parent="#controls"><div class="card-body">	<p>Don&#8217;t allow users to manipulate a system or guess its behavior based on input or output timing and detect the usage of automated tools or unusual behavior, such as actions not performed in reasonable &quot;human time&quot; or other abnormal time patterns. </p>

 When the usage of automated tools is detected, the application shall respond with denying the access and notifying the security group.</div></div></div><div class="card border-success"><div class="card-header " id="heading69"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse69" aria-expanded="true" aria-controls="collapse69">Countermeasure: Restrict actions of users that follow unusual patterns. <span>[OTG-BUSLOGIC-006]</span></button></h5></div><div id="collapse69" class="collapse" aria-labelledby="heading69" data-parent="#controls"><div class="card-body">	<p>Restrict actions that users can do outside of the approved/required business process flow. </p>

 This is important because without this safeguard in place attackers may be able to bypass or circumvent workflows and checks allowing them to prematurely enter or skip required sections of the application potentially allowing action/transaction to be completed without successfully completing the entire business process, leaving the system with incomplete backend tracking information.</div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="card border-primary"><div class="card-header " id="heading80"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse80" aria-expanded="true" aria-controls="collapse80">Risk pattern: AWS Lambda: Monitoring and Logging <span>[aws-lambda-monitoring-and-logging]</span></button></h5></div><div id="collapse80" class="collapse" aria-labelledby="heading80" data-parent="#components"><div class="card-body"><div class="accordion" id="usecases"><div class="card border-black"><div class="card-header " id="heading79"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse79" aria-expanded="true" aria-controls="collapse79">Use case: Monitoring and Logging <span>[MONITORING AND LOGGING]</span></button></h5></div><div id="collapse79" class="collapse" aria-labelledby="heading79" data-parent="#usecases"><div class="card-body"><div class="accordion" id="threats"><div class="card border-danger"><div class="card-header " id="heading78"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse78" aria-expanded="true" aria-controls="collapse78">Threat: An attacker injects, manipulates or forges malicious log entries in the log file, allowing her to mislead a log audit, cover traces of attack, or perform other malicious actions <span>[CAPEC-93]</span></button></h5></div><div id="collapse78" class="collapse" aria-labelledby="heading78" data-parent="#threats"><div class="card-body">	<p>This attack targets the log files of the target host. The attacker injects, manipulates or forges malicious log entries in the log file, allowing him to mislead a log audit, cover traces of attack, or perform other malicious actions. The target host is not properly controlling log access. As a result tainted data is resulting in the log files leading to a failure in accountability, non-repudiation and incident forensics capability.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading77"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse77" aria-expanded="true" aria-controls="collapse77">Weakness: Improper Access Control <span>[CWE-284]</span></button></h5></div><div id="collapse77" class="collapse" aria-labelledby="heading77" data-parent="#weaknesses"><div class="card-body">The software does not restrict or incorrectly restricts access to a resource from an unauthorized actor.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading74"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse74" aria-expanded="true" aria-controls="collapse74">Countermeasure: Increase log reports with serverless-specific information <span>[AWS-LAMBDA-LOG-SPECIFICS]</span></button></h5></div><div id="collapse74" class="collapse" aria-labelledby="heading74" data-parent="#controls"><div class="card-body"><p>Organizations adopting serverless architectures, are encouraged to augment log reports with serverless-specific information such as:&nbsp;</p> 
<p></p> 
<ul> 
 <li>Logging of API access keys related to successful/failed logins (authentication)&nbsp;</li> 
 <li>Attempts to invoke serverless functions with inadequate permissions (authorizations)&nbsp;</li> 
 <li>Successful/failed deployment of new serverless functions or configurations (change)</li> 
 <li>Changes to function permissions or execution roles (change)&nbsp;</li> 
 <li>Changes to files or access permissions on relevant cloud storage services (change)</li> 
 <li>Changes in function trigger definitions (change)</li> 
 <li>Anomalous interaction or irregular flow between serverless functions (change)</li> 
 <li>Changes to 3rd party dependencies (modules, libraries or APIs)</li> 
 <li>Outbound connections initiated by serverless functions (network)</li> 
 <li>Execution of serverless functions or access to data from an external 3rd party account not related to the main account to which the serverless application belongs (resource access)</li> 
 <li>Serverless function execution timeouts (failure reports)</li> 
 <li>Concurrent serverless function execution limits reached (failure reports)</li> 
</ul> 
<p></p> 
<p>Organizations are also encouraged to adopt serverless application logic/code runtime tracing and debugging facilities in order to gain better understanding of the overall system and data flow. For example: AWS X-Ray</p> 
<p><b>Remediation:</b><br /> To log more actions with the CloudTrail, we only have to create a trail as following:<br /></p> 
<ol> 
 <li>Create a trail. By default, when you create a trail in a region in the CloudTrail console, the trail applies to all regions.</li> 
 <li>Create an Amazon S3 bucket or specify an existing bucket where you want the log files delivered. By default, log files from all regions in your account are delivered to the bucket that you specify.</li> 
 <li>Configure your trail to log read-only, write-only, or all management events, and all or a subset of data events. By default, trails log all management events and no data events.</li> 
 <li>Create an Amazon SNS topic to receive notifications when log files are delivered. Delivery notifications from all regions are sent to the topic that you specify.</li> 
 <li>Configure CloudWatch Logs to receive your logs from CloudTrail so that you can monitor for specific log events.</li> 
 <li>Change the encryption method for your log files from server-side encryption with Amazon S3-managed encryption keys (SSE-S3) to server-side encryption with AWS KMS–managed keys (SSE-KMS).</li> 
 <li>Turn on integrity validation for log files. This enables the delivery of digest files that you can use to validate the integrity of log files after CloudTrail has delivered them.</li> 
 <li>Add tags (custom key-value pairs) to your trail.</li> 
</ol> 
<p></p></div></div></div><div class="card border-success"><div class="card-header " id="heading75"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse75" aria-expanded="true" aria-controls="collapse75">Countermeasure: Ensure the integrity of the logging system <span>[AWS-LOGS-INTEGRITY]</span></button></h5></div><div id="collapse75" class="collapse" aria-labelledby="heading75" data-parent="#controls"><div class="card-body"><p>Enable AWS Log integrity for the application generated logs, such as storing logs on write-once media, forwarding a copy of the logs to a centralized SIEM or generating message digests for each log file.</p> 
<p><b>Remediation:</b><br /></p> 
<ul> 
 <li>AWS Management Console:</li> 
 <ul> 
  <li>To enable log file integrity validation with the CloudTrail console, choose Yes for the Enable log file validation option when you create or update a trail. By default, this feature is enabled for new trails.</li> 
 </ul> 
</ul> 
<ul> 
 <li>AWS CLI:</li> 
 <ul> 
  <li>To enable log file integrity validation with the AWS CLI, use the --enable-log-file-validation option with the create-trail or update-trail commands.&nbsp;</li> 
  <li>To disable log file integrity validation, use the --no-enable-log-file-validation option.</li> 
  <li>For example:&nbsp;</li> 
 </ul> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <blockquote> 
   <p>aws cloudtrail update-trail --name your-trail-name --enable-log-file-validation</p> 
  </blockquote> 
 </blockquote> 
</blockquote> 
<p></p> 
<ul> 
 <li>CloudTrail API:</li> 
 <ul> 
  <li>To enable log file integrity validation with the CloudTrail API, set the EnableLogFileValidation request parameter to true when calling CreateTrail or UpdateTrail.</li> 
 </ul> 
</ul> 
<p></p></div></div></div><div class="card border-success"><div class="card-header " id="heading76"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse76" aria-expanded="true" aria-controls="collapse76">Countermeasure: Limit the number of accounts with privileges allowing modification and/or deletion of audit logs files <span>[AWS-RESTRICT-NUMBER-ACCOUNT-TO-LOGS]</span></button></h5></div><div id="collapse76" class="collapse" aria-labelledby="heading76" data-parent="#controls"><div class="card-body"><p>Limit the number of accounts with privileges to modify and/or delete audit logs files.</p> 
<p>The following AWS managed policies, which you can attach to users in your account, are specific to CloudWatch Logs:<br /></p> 
<ul> 
 <li>CloudWatchLogsFullAccess – Grants full access to CloudWatch Logs.</li> 
 <li>CloudWatchLogsReadOnlyAccess – Grants read-only access to CloudWatch Logs.</li> 
</ul> 
<p></p> 
<p>By default, all user shall only have got the managed policy “CloudWatchLogsReadOnlyAccess”, and only few users shall have got the managed policy “CloudWatchLogsFullAccess”.</p> 
<p><b>Remediation:</b><br /></p> 
<ul> 
 <li>Go to the AWS CLI.</li> 
 <li>List all users, with the following command:&nbsp;</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p>aws iam list-users</p> 
 </blockquote> 
</blockquote> 
<p></p> 
<ul> 
 <li>Run the following command per user to ensure that only the desired users have got the managed policy “CloudWatchLogsFullAccess” and the other users the managed policy “CloudWatchLogsReadOnlyAccess”, to do it run the following command per username:&nbsp;</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p>aws iam list-attached-user-policies --user-name [userName]</p> 
 </blockquote> 
</blockquote> 
<p></p> 
<ul> 
 <li>If there is at least user with the managed policy “CloudWatchLogsFullAccess” and it shall not be allowed, we have to change the managed policy for these users.&nbsp;</li> 
 <li>Run the following command per each user to remove the managed policy:&nbsp;</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p>aws iam delete-user-policy --user-name [userName] --policy-name CloudWatchLogsFullAccess</p> 
 </blockquote> 
</blockquote> 
<ul> 
 <li>Run the following command per each user to add a new managed policy:&nbsp;</li> 
</ul> 
<blockquote> 
 <blockquote> 
  <p>aws iam attach-user-policy --policy-arn arn:aws:iam::aws:policy/CloudWatchLogsReadOnlyAccess --user-name [userName]</p> 
 </blockquote> 
</blockquote></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="card border-primary"><div class="card-header " id="heading90"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse90" aria-expanded="true" aria-controls="collapse90">Risk pattern: AWS Lambda: Patching <span>[aws-lambda-patching]</span></button></h5></div><div id="collapse90" class="collapse" aria-labelledby="heading90" data-parent="#components"><div class="card-body"><div class="accordion" id="usecases"><div class="card border-black"><div class="card-header " id="heading89"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse89" aria-expanded="true" aria-controls="collapse89">Use case: Patching <span>[PATCHING]</span></button></h5></div><div id="collapse89" class="collapse" aria-labelledby="heading89" data-parent="#usecases"><div class="card-body"><div class="accordion" id="threats"><div class="card border-danger"><div class="card-header " id="heading85"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse85" aria-expanded="true" aria-controls="collapse85">Threat: Attackers exploit an unused function to enter the system <span>[AWS-LAMBDA-T3]</span></button></h5></div><div id="collapse85" class="collapse" aria-labelledby="heading85" data-parent="#threats"><div class="card-body">	<p>A &quot;problem&quot; with serverless architecture is that you don’t pay for functions that aren’t used. This means that your unused functions will not appear on your bill. If the unused functions become forgotten, they can become a threat. Those functions will not be updated or patched.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading82"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse82" aria-expanded="true" aria-controls="collapse82">Weakness: Unused functions are more risk from a security standpoint as they are often not maintained <span>[AWS-LAMBDA-W6]</span></button></h5></div><div id="collapse82" class="collapse" aria-labelledby="heading82" data-parent="#weaknesses"><div class="card-body">Unused functions are mostly unmaintained. Therefore code may not be regularly reviewed. And because the code isn't under your attention, this can impose a security risk, especially if the functionality of your application changes over time.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading81"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse81" aria-expanded="true" aria-controls="collapse81">Countermeasure: Review and remove unused functions <span>[AWS-LAMBDA-C7]</span></button></h5></div><div id="collapse81" class="collapse" aria-labelledby="heading81" data-parent="#controls"><div class="card-body"><p>Review the current Lambda Functions and remove those unused functions from the system.</p> 
<p><b>Remediation:<br /></b> To list all functions:<br /></p> 
<ul> 
 <li>Go to the AWS CLI, and write the following command:</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p>aws list-functions</p> 
 </blockquote> 
</blockquote> 
<ul> 
 <li>Review all functions search those unused functions.</li> 
</ul> 
<p>To remove a certain function:<br /></p> 
<ul> 
 <li>Go to the AWS CLI, and write the following command:</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p> aws delete-function —function-name </p> 
 </blockquote> 
</blockquote></div></div></div></div></div></div></div><div class="card border-warning"><div class="card-header " id="heading84"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse84" aria-expanded="true" aria-controls="collapse84">Weakness: Unused functions have vulnerable dependencies because they were never updated <span>[AWS-LAMBDA-W5]</span></button></h5></div><div id="collapse84" class="collapse" aria-labelledby="heading84" data-parent="#weaknesses"><div class="card-body">Unused functions remain mostly unpatched. So if dependencies have vulnerabilities, this might not catch your attention and could create a security weak point.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading83"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse83" aria-expanded="true" aria-controls="collapse83">Countermeasure: Regularly check for known vulnerabilities in the dependencies of your project <span>[CWE-937]</span></button></h5></div><div id="collapse83" class="collapse" aria-labelledby="heading83" data-parent="#controls"><div class="card-body"><p>Vulnerabilities in common popular and shared libraries are published and recorded in a number of online databases and services, including the MITRE CVE and CWE databases.<br /></p> 
<ul> 
 <li>Perform regular checks for published vulnerabilities in third party components and the IDE.</li> 
 <li>Test and apply appropriate recommended patches and mitigations.</li> 
 <li>Use subscription threat intelligence and alerting services to ensure timely notification of possible threats</li> 
 <li>Use automated vulnerability scanning tools to identify and test for security threats to the project.</li> 
</ul> 
<p></p></div></div></div></div></div></div></div></div></div></div></div><div class="card border-danger"><div class="card-header " id="heading88"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse88" aria-expanded="true" aria-controls="collapse88">Threat: Lambda functions are compromised through exploiting vulnerable dependencies <span>[AWS-LAMBDA-T10]</span></button></h5></div><div id="collapse88" class="collapse" aria-labelledby="heading88" data-parent="#threats"><div class="card-body">	<p>Functions often use third-party libraries or frameworks. These dependencies can be vulnerable and new vulnerabilities are regularly disclosed. As soon as a vulnerability is registered in the CVE database, attackers will try to exploit the vulnerability within hours using automated exploits.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading87"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse87" aria-expanded="true" aria-controls="collapse87">Weakness: Functions use vulnerable dependencies  <span>[AWS-LAMBDA-W13]</span></button></h5></div><div id="collapse87" class="collapse" aria-labelledby="heading87" data-parent="#weaknesses"><div class="card-body">Dependency management is a widespread problem in development. Developers may be unaware that third-party libraries or frameworks can contain vulnerabilities and those vulnerabilities are being constantly detected.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading86"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse86" aria-expanded="true" aria-controls="collapse86">Countermeasure: Regularly check for known vulnerabilities in the dependencies of your project <span>[CWE-937]</span></button></h5></div><div id="collapse86" class="collapse" aria-labelledby="heading86" data-parent="#controls"><div class="card-body"><p>Vulnerabilities in common popular and shared libraries are published and recorded in a number of online databases and services, including the MITRE CVE and CWE databases.<br /></p> 
<ul> 
 <li>Perform regular checks for published vulnerabilities in third party components and the IDE.</li> 
 <li>Test and apply appropriate recommended patches and mitigations.</li> 
 <li>Use subscription threat intelligence and alerting services to ensure timely notification of possible threats</li> 
 <li>Use automated vulnerability scanning tools to identify and test for security threats to the project.</li> 
</ul> 
<p></p></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="card border-primary"><div class="card-header " id="heading113"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse113" aria-expanded="true" aria-controls="collapse113">Risk pattern: AWS Lambda: Tampering <span>[aws-lambda-tampering]</span></button></h5></div><div id="collapse113" class="collapse" aria-labelledby="heading113" data-parent="#components"><div class="card-body"><div class="accordion" id="usecases"><div class="card border-black"><div class="card-header " id="heading112"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse112" aria-expanded="true" aria-controls="collapse112">Use case: General <span>[GENERAL]</span></button></h5></div><div id="collapse112" class="collapse" aria-labelledby="heading112" data-parent="#usecases"><div class="card-body"><div class="accordion" id="threats"><div class="card border-danger"><div class="card-header " id="heading94"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse94" aria-expanded="true" aria-controls="collapse94">Threat: Lambda function is compromised through a code injection attack <span>[AWS-LAMBDA-T15]</span></button></h5></div><div id="collapse94" class="collapse" aria-labelledby="heading94" data-parent="#threats"><div class="card-body">	<p>When input validation is non-existent or not strong, malicious code can be injected through the input parameters. This may compromise the complete application and data stores.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading93"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse93" aria-expanded="true" aria-controls="collapse93">Weakness: The function takes untrusted input <span>[AWS-LAMBDA-W9]</span></button></h5></div><div id="collapse93" class="collapse" aria-labelledby="heading93" data-parent="#weaknesses"><div class="card-body">Developers should avoid writing code that passes user-controlled input to dangerous functions. This is one of the basics of secure programming. Whenever a function has the capability to execute a dangerous action, it should either not receive user input, or the user-controlled data should be sanitized in order to prevent a malicious user from breaking the intended functionality.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading91"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse91" aria-expanded="true" aria-controls="collapse91">Countermeasure: Enable and set up Request Validation in API Gateway <span>[AWS-LAMBDA-C11]</span></button></h5></div><div id="collapse91" class="collapse" aria-labelledby="heading91" data-parent="#controls"><div class="card-body"><p>To perform the API Gateway basic validation, we have to enable and set up the Request Validation in the API Gateway.</p> 
<p><b>Remediation:</b><br /> To enable basic validation, you specify validation rules in a request validator, add the validator to the API’s map of request validators, and assign the validator to individual API methods.</p> 
<p>To set up a basic validation, we have some possibilities to configure it:<br /></p> 
<ul> 
 <li>by Importing OpenAPI Definition</li> 
 <li>using the API Gateway REST API</li> 
 <li>using the API Gateway Console</li> 
</ul> 
<p></p> 
<p>Using the API Gateway Console:<br /> The API Gateway console lets you set up the basic request validation on a method using one of the three validators:<br /></p> 
<ul> 
 <li>Validate body: This is the body-only validator.</li> 
 <li>Validate query string parameters and headers: This is the parameters-only validator.</li> 
 <li>Validate body, query string parameters, and headers: This validator is for both body and parameters validation.</li> 
</ul> 
<p></p> 
<p>When you choose one of the above validators to enable it on an API method, the API Gateway console will add the validator to the API’s RequestValidators map, if the validator has not already been added to the validators map of the API.</p> 
<p>To enable a request validator on a method:<br /></p> 
<ol> 
 <li>Sign in to the API Gateway console, if not already logged in.</li> 
 <li>Create a new or choose an existing API.</li> 
 <li>Create a new or choose an existing resource of the API.</li> 
 <li>Create a new or choose an existing method the resource.</li> 
 <li>Choose Method Request.</li> 
 <li>Choose the pencil icon of Request Validator under Settings.</li> 
 <li>Choose Validate body, Validate query string parameters and headers or Validate body, query string parameters, and headers from the Request Validator drop-down list and then choose the check mark icon to save your choice.</li> 
</ol> 
<p></p> 
<p>For more information see the references.</p></div></div></div><div class="card border-success"><div class="card-header " id="heading92"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse92" aria-expanded="true" aria-controls="collapse92">Countermeasure: Validate all data received <span>[DATA-VAL-GENERIC]</span></button></h5></div><div id="collapse92" class="collapse" aria-labelledby="heading92" data-parent="#controls"><div class="card-body"><p>All data received shall be considered tainted and a potential risk, regardless of the source or transport method. For example, while hidden form fields, cookies, or other headers may be obfuscated from a user, along with parameters passed in ViewStates or other encapsulated forms, these can be modified by the user on the client-side in memory, or in transit on the network. Similarly, data passed from binary or compiled components can be modified in situ or in transit. </p> 
<p>Furthermore, encryption only secures the data in transit between the two ends of the encrypted tunnel (one end of which is typically controlled by the client); data passing through the link may still be malicious.</p> 
<p>As such, all data received must be subjected to strict validation, sanitization, and encoding against expected syntactic and semantic criteria.</p> 
<p> Define a specification of the data that is expected at each input; both the syntax (e.g. alphanumeric only) and semantics (e.g. a word of between 1 and 25 characters, or a specific list). As an example of business rule logic, “boat” may be syntactically valid because it only contains alphanumeric characters, but it is not valid if the input is only expected to contain colors such as “red” or “blue.”<br /> Implement a ‘known good’ or white-list approach, where only inputs that meet the strict criteria for each input are accepted, and reject, transform, or encapsulate any non-compliant data.</p> 
<p> While useful for identifying malicious content, do not rely on looking for specific malformed or attack payloads (blacklists). It is almost impossible to maintain a comprehensive and accurate blacklist due to the complexity and evolving nature of attacks, opportunities to obfuscate payloads, and changes to the code’s execution environment. As noted, blacklists can be useful for detecting and logging potential attacks, or determining which inputs are so malformed that they should be rejected outright.&nbsp;</p> 
<p> Validate all data received from the client, including values such as HTTP headers and cookie values if these are used as input on the server side, X- headers, and other platform specific data objects passed between the client and server.</p></div></div></div></div></div></div></div></div></div></div></div><div class="card border-danger"><div class="card-header " id="heading98"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse98" aria-expanded="true" aria-controls="collapse98">Threat: Lambda function is exploited by a non-HTTP event through code injection <span>[AWS-LAMBDA-T5]</span></button></h5></div><div id="collapse98" class="collapse" aria-labelledby="heading98" data-parent="#threats"><div class="card-body">	<p>A Lambda function can be triggered by a non-HTTP event (e.g. S3, SNS, SES, CloudWatch Events, etc.). When input validation is non-existing or not strong, malicious code can be injected through the input parameters. This may lead to complete compromise of the application and data stores.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading97"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse97" aria-expanded="true" aria-controls="collapse97">Weakness: The function takes untrusted input <span>[AWS-LAMBDA-W9]</span></button></h5></div><div id="collapse97" class="collapse" aria-labelledby="heading97" data-parent="#weaknesses"><div class="card-body">Developers should avoid writing code that passes user-controlled input to dangerous functions. This is one of the basics of secure programming. Whenever a function has the capability to execute a dangerous action, it should either not receive user input, or the user-controlled data should be sanitized in order to prevent a malicious user from breaking the intended functionality.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading95"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse95" aria-expanded="true" aria-controls="collapse95">Countermeasure: Enable and set up Request Validation in API Gateway <span>[AWS-LAMBDA-C11]</span></button></h5></div><div id="collapse95" class="collapse" aria-labelledby="heading95" data-parent="#controls"><div class="card-body"><p>To perform the API Gateway basic validation, we have to enable and set up the Request Validation in the API Gateway.</p> 
<p><b>Remediation:</b><br /> To enable basic validation, you specify validation rules in a request validator, add the validator to the API’s map of request validators, and assign the validator to individual API methods.</p> 
<p>To set up a basic validation, we have some possibilities to configure it:<br /></p> 
<ul> 
 <li>by Importing OpenAPI Definition</li> 
 <li>using the API Gateway REST API</li> 
 <li>using the API Gateway Console</li> 
</ul> 
<p></p> 
<p>Using the API Gateway Console:<br /> The API Gateway console lets you set up the basic request validation on a method using one of the three validators:<br /></p> 
<ul> 
 <li>Validate body: This is the body-only validator.</li> 
 <li>Validate query string parameters and headers: This is the parameters-only validator.</li> 
 <li>Validate body, query string parameters, and headers: This validator is for both body and parameters validation.</li> 
</ul> 
<p></p> 
<p>When you choose one of the above validators to enable it on an API method, the API Gateway console will add the validator to the API’s RequestValidators map, if the validator has not already been added to the validators map of the API.</p> 
<p>To enable a request validator on a method:<br /></p> 
<ol> 
 <li>Sign in to the API Gateway console, if not already logged in.</li> 
 <li>Create a new or choose an existing API.</li> 
 <li>Create a new or choose an existing resource of the API.</li> 
 <li>Create a new or choose an existing method the resource.</li> 
 <li>Choose Method Request.</li> 
 <li>Choose the pencil icon of Request Validator under Settings.</li> 
 <li>Choose Validate body, Validate query string parameters and headers or Validate body, query string parameters, and headers from the Request Validator drop-down list and then choose the check mark icon to save your choice.</li> 
</ol> 
<p></p> 
<p>For more information see the references.</p></div></div></div><div class="card border-success"><div class="card-header " id="heading96"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse96" aria-expanded="true" aria-controls="collapse96">Countermeasure: Validate all data received <span>[DATA-VAL-GENERIC]</span></button></h5></div><div id="collapse96" class="collapse" aria-labelledby="heading96" data-parent="#controls"><div class="card-body"><p>All data received shall be considered tainted and a potential risk, regardless of the source or transport method. For example, while hidden form fields, cookies, or other headers may be obfuscated from a user, along with parameters passed in ViewStates or other encapsulated forms, these can be modified by the user on the client-side in memory, or in transit on the network. Similarly, data passed from binary or compiled components can be modified in situ or in transit. </p> 
<p>Furthermore, encryption only secures the data in transit between the two ends of the encrypted tunnel (one end of which is typically controlled by the client); data passing through the link may still be malicious.</p> 
<p>As such, all data received must be subjected to strict validation, sanitization, and encoding against expected syntactic and semantic criteria.</p> 
<p> Define a specification of the data that is expected at each input; both the syntax (e.g. alphanumeric only) and semantics (e.g. a word of between 1 and 25 characters, or a specific list). As an example of business rule logic, “boat” may be syntactically valid because it only contains alphanumeric characters, but it is not valid if the input is only expected to contain colors such as “red” or “blue.”<br /> Implement a ‘known good’ or white-list approach, where only inputs that meet the strict criteria for each input are accepted, and reject, transform, or encapsulate any non-compliant data.</p> 
<p> While useful for identifying malicious content, do not rely on looking for specific malformed or attack payloads (blacklists). It is almost impossible to maintain a comprehensive and accurate blacklist due to the complexity and evolving nature of attacks, opportunities to obfuscate payloads, and changes to the code’s execution environment. As noted, blacklists can be useful for detecting and logging potential attacks, or determining which inputs are so malformed that they should be rejected outright.&nbsp;</p> 
<p> Validate all data received from the client, including values such as HTTP headers and cookie values if these are used as input on the server side, X- headers, and other platform specific data objects passed between the client and server.</p></div></div></div></div></div></div></div></div></div></div></div><div class="card border-danger"><div class="card-header " id="heading105"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse105" aria-expanded="true" aria-controls="collapse105">Threat: Lambda functions are accessible through an unclean container <span>[AWS-LAMBDA-T9]</span></button></h5></div><div id="collapse105" class="collapse" aria-labelledby="heading105" data-parent="#threats"><div class="card-body">	<p>Cloud providers run your functions in a container. Because you want your function to execute as fast and efficient as possible, the containers are kept warm. This means that a container will be persistent for a while after a function is executed. This could leave room for a successful attack on the container.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading100"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse100" aria-expanded="true" aria-controls="collapse100">Weakness: Containers aren’t monitored <span>[AWS-LAMBDA-W12]</span></button></h5></div><div id="collapse100" class="collapse" aria-labelledby="heading100" data-parent="#weaknesses"><div class="card-body">Monitoring is needed to understand the relationships between all of the objects across a virtual environment’s topology, recognize the difference between inconsequential anomalies and actual performance problems. This will show you the root cause and recommended actions for remediation. This way, you can understand what needs your attention, and how to narrow a problem to the relevant components.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading99"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse99" aria-expanded="true" aria-controls="collapse99">Countermeasure: Monitor the containers for processes hanging. <span>[AWS-LAMBDA-C18]</span></button></h5></div><div id="collapse99" class="collapse" aria-labelledby="heading99" data-parent="#controls"><div class="card-body"><p>Use CloudWatch to monitor the containers and the processes</p> 
<p><b>Remediation:<br /></b> Before your container instances can send log data to CloudWatch Logs, you must create an IAM policy to allow your container instances to use the CloudWatch Logs APIs, and then you must attach that policy to ecsInstanceRole.</p> 
<p>To create the ECS-CloudWatchLogs IAM policy<br /></p> 
<ol> 
 <li>Open the IAM console at https://console.aws.amazon.com/iam/.</li> 
 <li>In the navigation pane, choose Policies.</li> 
 <li>Choose Create policy, JSON.</li> 
 <li>Enter the following policy:{ “Version”: “2012-10-17”, “Statement”: [ { “Effect”: “Allow”, “Action”: [ “logs:CreateLogGroup”, “logs:CreateLogStream”, “logs:PutLogEvents”, “logs:DescribeLogStreams” ], “Resource”: [ “arn:aws:logs:<strong>:*:</strong>” ] } ]}</li> 
 <li>Choose Review policy.</li> 
 <li>On the Review policy page, enter ECS-CloudWatchLogs for the Name and choose Create policy.</li> 
</ol> 
<p></p> 
<p>To attach the ECS-CloudWatchLogs policy to ecsInstanceRole<br /></p> 
<ol> 
 <li>Open the IAM console at https://console.aws.amazon.com/iam/.</li> 
 <li>In the navigation pane, choose Roles.</li> 
 <li>Choose ecsInstanceRole. If the role does not exist, follow the procedures in Amazon ECS Container Instance IAM Role to create the role.</li> 
 <li>Choose Permissions, Attach policy.</li> 
 <li>To narrow the available policies to attach, for Filter, type ECS-CloudWatchLogs.</li> 
 <li>Check the box to the left of the ECS-CloudWatchLogs policy and choose Attach policy.</li> 
</ol> 
<p></p> 
<p>To install the CloudWatch Logs agent:<br /> Run the following command to install the CloudWatch Logs agent.<br /></p> 
<blockquote> 
 <p> sudo yum install -y awslogs</p> 
</blockquote> 
<p>To configure the CloudWatch Logs agent:<br /></p> 
<ol> 
 <li>Back up the existing CloudWatch Logs agent configuration file: sudo mv /etc/awslogs/awslogs.conf /etc/awslogs/awslogs.conf.bak</li> 
 <li>Create a blank configuration file: sudo touch /etc/awslogs/awslogs.conf</li> 
 <li>Open the /etc/awslogs/awslogs.conf file with a text editor, and copy the example file above into it.</li> 
 <li>Install the jq JSON query utility: sudo yum install -y jq</li> 
 <li>Query the Amazon ECS introspection API to find the cluster name and set it to an environment variable: cluster=$(curl -s http://localhost:51678/v1/metadata | jq -r ‘. | .Cluster’)</li> 
 <li>Replace the {cluster} placeholders in the file with the value of the environment variable you set in the previous step: sudo sed -i -e “s/{cluster}/$cluster/g” /etc/awslogs/awslogs.conf</li> 
 <li>Query the Amazon ECS introspection API operation to find the container instance ID and set it to an environment variable: container_instance_id=$(curl -s http://localhost:51678/v1/metadata | jq -r ‘. | .ContainerInstanceArn’ | awk -F/ ‘{print $2}’ )</li> 
 <li>Replace the {container_instance_id} placeholders in the file with the value of the environment variable you set in the previous step: sudo sed -i -e “s/{container_instance_id}/$container_instance_id/g” /etc/awslogs/awslogs.conf</li> 
</ol> 
<p></p> 
<p>To configure the CloudWatch Logs agent Region:<br /> By default, the CloudWatch Logs agent sends data to the us-east-1 region. To send your data to a different region, such as the Region in which your cluster is located, you can set the Region in the /etc/awslogs/awscli.conf file.<br /></p> 
<ol> 
 <li>Open the /etc/awslogs/awscli.conf file with a text editor.</li> 
 <li>In the [default] section, replace us-east-1 with the Region from which to view log data.</li> 
 <li>Save the file and exit your text editor.</li> 
</ol> 
<p></p> 
<p>To start the CloudWatch Logs agent<br /></p> 
<ol> 
 <li>Start the CloudWatch Logs agent with the following command.</li> 
 <ul> 
  <li>Amazon Linux: sudo service awslogs start</li> 
  <li>Amazon Linux 2: sudo systemctl start awslogsd</li> 
 </ul> 
 <li>Ensure that the CloudWatch Logs agent starts at every system boot with the following command.</li> 
 <ul> 
  <li>Amazon Linux: sudo chkconfig awslogs on</li> 
  <li>Amazon Linux 2: sudo systemctl enable awslogsd.service</li> 
 </ul> 
</ol> 
<p></p></div></div></div></div></div></div></div><div class="card border-warning"><div class="card-header " id="heading104"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse104" aria-expanded="true" aria-controls="collapse104">Weakness: The container has processes, pieces of code or temporary files lingering around. <span>[AWS-LAMBDA-W11]</span></button></h5></div><div id="collapse104" class="collapse" aria-labelledby="heading104" data-parent="#weaknesses"><div class="card-body">Container lifetime is important, but also the correct execution and cleanup of your functions. If the container has lingering temporary files or - for example - static data in memory, an attacker could steal this information and leverage it for building a more destructive attack.<div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading101"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse101" aria-expanded="true" aria-controls="collapse101">Countermeasure: Limit the lifetime of your containers <span>[AWS-LAMBDA-C17]</span></button></h5></div><div id="collapse101" class="collapse" aria-labelledby="heading101" data-parent="#controls"><div class="card-body"><p>Ensure that your containers and functions lifecycles are handled correctly and no lingering processes exist.</p> 
<p><b>Remediation:<br /></b> Use CloudWatch metrics to view the number of tasks in your services that are in the RUNNING state and set a CloudWatch alarm for this metric to alert you if the number of running tasks in your service falls below a specified value.</p> 
<p> To view the number of running tasks in a service<br /></p> 
<ol> 
 <li>Open the CloudWatch console at https://console.aws.amazon.com/cloudwatch/.</li> 
 <li>On the navigation pane, choose Metrics.</li> 
 <li>On the All metrics tab, choose ECS.</li> 
 <li>Choose ClusterName, ServiceName and then choose any metric (either CPUUtilization or MemoryUtilization) that corresponds to the service to view running tasks in.</li> 
 <li>On the Graphed metrics tab, change Period to 1 Minute and Statistic to Sample Count.</li> 
</ol> 
<p></p> 
<p>To create a CloudWatch alarm on a metric<br /></p> 
<ol> 
 <li>Open the CloudWatch console at https://console.aws.amazon.com/cloudwatch/.</li> 
 <li>On the left navigation, choose Alarms, Create Alarm.</li> 
 <li>In the CloudWatch Metrics by Category section, choose ECS Metrics &gt; ClusterName.</li> 
 <li>On the Modify Alarm page, choose the MemoryReservation metric for the default cluster and choose Next.</li> 
 <li>In the Alarm Threshold section, enter a name and description for your alarm.</li> 
 <li>Set the threshold and time period requirement to MemoryReservation greater than 75% for 1 period.</li> 
 <li>Configure a notification to send when the alarm is triggered. You can also choose to delete the notification if you don’t want to configure one now.</li> 
</ol> 
<p></p></div></div></div><div class="card border-success"><div class="card-header " id="heading102"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse102" aria-expanded="true" aria-controls="collapse102">Countermeasure: Change the default memory usage to the amount of memory the function really needs <span>[AWS-LAMBDA-C20]</span></button></h5></div><div id="collapse102" class="collapse" aria-labelledby="heading102" data-parent="#controls"><div class="card-body"><p>Specify the amount of memory you want to allocate for your Lambda function. CloudWatch logs can contain memory usage on each function execution. Set the default memory usage to the amount of memory that the function really needs. By default, it set to of 1024 MB.</p> 
<p><b>Remediation:<br /></b> Update the memory size of your functions using the following AWS CLI command:<br /></p> 
<blockquote> 
 <p> aws lambda update-function-configuration --function-name myfunction --memory-size 256</p> 
</blockquote> 
<p>In the example, we change the amount memory for the function to 256 MB.</p></div></div></div><div class="card border-success"><div class="card-header " id="heading103"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse103" aria-expanded="true" aria-controls="collapse103">Countermeasure: Use a profiler tool to improve the application <span>[AWS-LAMBDA-C23]</span></button></h5></div><div id="collapse103" class="collapse" aria-labelledby="heading103" data-parent="#controls"><div class="card-body">	<p>When using a profiler tool, the execution of your functions are monitored. It will reveal which functions are called, number of invocations, execution times, memory usage and CPU use.</p>

	<p>You can use it to find and identify bottlenecks and address them. Therefore, you shall use a profiler tool to improve the time of use, memory usage and CPU usage of the function.</p></div></div></div></div></div></div></div></div></div></div></div><div class="card border-danger"><div class="card-header " id="heading111"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse111" aria-expanded="true" aria-controls="collapse111">Threat: Man in the Middle Attack <span>[CAPEC-94]</span></button></h5></div><div id="collapse111" class="collapse" aria-labelledby="heading111" data-parent="#threats"><div class="card-body">	<p>This type of attack targets the communication between two components (typically client and server). The attacker places himself in the communication channel between the two components. Whenever one component attempts to communicate with the other (data flow, authentication challenges, etc.), the data first goes to the attacker, who has the opportunity to observe or alter it, and it is then passed on to the other component as if it was never intercepted. This interposition is transparent leaving the two compromised components unaware of the potential corruption or leakage of their communications. The potential for Man-in-the-Middle attacks yields an implicit lack of trust in communication or identify between two components.</p><div class="accordion" id="weaknesses"><div class="card border-warning"><div class="card-header " id="heading108"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse108" aria-expanded="true" aria-controls="collapse108">Weakness: Data in transit is sent using a weak encryption algorithm <span>[AWS-LAMBDA-W4]</span></button></h5></div><div id="collapse108" class="collapse" aria-labelledby="heading108" data-parent="#weaknesses"><div class="card-body">When the SSL/TLS service is present this is good but does introduce complexities that must be overcome:&nbsp; 
<div> 
 <ol> 
  <li>SSL/TLS protocols, ciphers, keys and renegotiation must be properly configured.&nbsp;</li> 
  <li>Certificate validity must be ensured.</li> 
 </ol> 
</div><div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading106"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse106" aria-expanded="true" aria-controls="collapse106">Countermeasure: Ensure you store your encryption keys in a Key Management System <span>[AWS-LAMBDA-C5]</span></button></h5></div><div id="collapse106" class="collapse" aria-labelledby="heading106" data-parent="#controls"><div class="card-body"><p>AWS Key Management Service (KMS) is a managed service that makes it easy for you to create and control the encryption keys used to encrypt your data, and uses FIPS 140-2 validated hardware security modules to protect the security of your keys. AWS Key Management Service is integrated with most other AWS services to help you protect the data you store with these services. AWS Key Management Service is also integrated with AWS CloudTrail to provide you with logs of all key usage to help meet your regulatory and compliance needs.</p> 
<p><b>Remediation:<br /></b> Verify that you are using the Key Management Service. You can see a list of your customer managed keys in the AWS Management Console.<br /> To view your CMKs (console): <br /></p> 
<ol> 
 <li>Sign in to the AWS Management Console and open the AWS Identity and Access Management (IAM) console at https://console.aws.amazon.com/iam/.&nbsp;</li> 
 <li>In the left navigation pane, choose Encryption keys.&nbsp;</li> 
 <li>For Region, choose the appropriate AWS Region. Do not use the region selector in the navigation bar (top right corner). The console shows all the CMKs in your AWS account in the chosen region, including customer-managed and AWS managed CMKs. The page displays the alias, key ID, status, and creation date for each CMK.</li> 
</ol> 
<p></p> 
<p>If you need to create a CMK:<br /></p> 
<ol> 
 <li>Sign in to the AWS Management Console and open the AWS Key Management Service (AWS KMS) console at https://console.aws.amazon.com/kms.</li> 
 <li>To change the AWS Region, use the Region selector in the upper-right corner of the page.</li> 
 <li>In the navigation pane, choose Customer managed keys.</li> 
 <li>Choose Create key.</li> 
 <li>Type an alias for the CMK. The alias name cannot begin with aws/. The aws/ prefix is reserved by Amazon Web Services to represent AWS managed CMKs in your account.</li> 
 <li>An alias is a display name that you can use to identify the CMK. We recommend that you choose an alias that indicates the type of data you plan to protect or the application you plan to use with the CMK.</li> 
 <li>Aliases are required when you create a CMK in the AWS Management Console. They are optional when you use the CreateKey operation.</li> 
 <li>(Optional) Type a description for the CMK.</li> 
 <li>We recommend that you choose a description that explains the type of data you plan to protect or the application you plan to use with the CMK.</li> 
 <li>Choose Next.</li> 
 <li>(Optional) Type a tag key and an optional tag value. To add more than one tag to the CMK, choose Add tag.</li> 
 <li>When you add tags to your AWS resources, AWS generates a cost allocation report with usage and costs aggregated by tags. For information about tagging CMKs, see Tagging Keys.</li> 
 <li>Choose Next.</li> 
 <li>Select the IAM users and roles that can administer the CMK.</li> 
 <li>(Optional) To prevent the selected IAM users and roles from deleting this CMK, in the Key deletion section at the bottom of the page, clear the Allow key administrators to delete this key check box.</li> 
 <li>Choose Next.</li> 
 <li>Select the IAM users and roles that can use the CMK for cryptographic operations.</li> 
 <li>(Optional) You can allow other AWS accounts to use this CMK for cryptographic operations. To do so, in the Other AWS accounts section at the bottom of the page, choose Add another AWS account and enter the AWS account identification number of an external account. To add multiple external accounts, repeat this step.</li> 
 <li>Choose Next.</li> 
 <li>Review the key policy document that was created from your choices. You can edit it, too.</li> 
 <li>Choose Finish to create the CMK.</li> 
</ol> 
<p></p></div></div></div><div class="card border-success"><div class="card-header " id="heading107"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse107" aria-expanded="true" aria-controls="collapse107">Countermeasure: Ensure CloudFront to Origin connection is configured using TLS1.1+ as the SSL\TLS protocol <span>[aws-tier-1.17]</span></button></h5></div><div id="collapse107" class="collapse" aria-labelledby="heading107" data-parent="#controls"><div class="card-body"><p>CloudFront can connect to your origin using only HTTP, only HTTPS, or to connect by matching the protocol used by the viewer. Our recommendation is to use HTTPS only. In this case you can choose which SSL\TLS protocols CloudFront is allowed to use when establishing an HTTPS connection to your origin. Ensure that you are using only TLS1.1+ as the SSL\TLS protocol.</p> 
<p>It used to be believed that TLS v1 was marginally more secure than SSL v3.0, its predecessor. However, developments, such as the POODLE vulnerability have shown that SSL v3.0 is now insecure.</p> 
<p>Subsequent versions of TLS v1.1 and v1.2 are significantly more secure and fix many vulnerabilities present in SSL v3.0 and TLS v1. For example, the BEAST attack that can completely break web sites running on older SSL v3.0 and TLS v1 protocols. The newer TLS versions, if properly configured, prevent the BEAST and other attack vectors and provide many stronger ciphers and encryption methods.</p> 
<p><b>Remediation:<br /></b> Using the Amazon unified command line interface:<br /></p> 
<ul> 
 <li>For configuring Origin SSL protocols first save locally the current distribution config:</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p> aws cloudfront get-distribution-config --id --query “DistributionConfig” &gt; /tmp/cf-distribution.json</p> 
 </blockquote> 
</blockquote> 
<p></p> 
<ul> 
 <li>Edit and replace “OriginSslProtocols” element in /tmp/cf-distribution.json with the below section:</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p> “OriginSslProtocols”: { “Items”: [ “TLSv1.1”, “TLSv1.2” ], “Quantity”: 2},</p> 
 </blockquote> 
</blockquote> 
<p></p> 
<ul> 
 <li>Retrieve the current ETag of your CloudFront distribution:</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p> aws cloudfront get-distribution-config --id --query “ETag”</p> 
 </blockquote> 
</blockquote> 
<p></p> 
<ul> 
 <li>Update the CloudFront distribution using the edited config and the above Etag:</li> 
</ul> 
<p></p> 
<blockquote> 
 <blockquote> 
  <p> aws cloudfront update-distribution --id --distribution-config file:///tmp/cf-distribution.json --if-match </p> 
 </blockquote> 
</blockquote></div></div></div></div></div></div></div><div class="card border-warning"><div class="card-header " id="heading110"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse110" aria-expanded="true" aria-controls="collapse110">Weakness: Data in transit was sent via an unencrypted protocol <span>[AWS-LAMBDA-W3]</span></button></h5></div><div id="collapse110" class="collapse" aria-labelledby="heading110" data-parent="#weaknesses"><div class="card-body">Sensitive data must be protected when it is transmitted through the network. Currently the security best practice is to send any data over an encrypted channel. As a rule of thumb if data must be protected when it is stored, this data must also be protected during transmission.&nbsp; 
<div> 
 <br /> 
</div> 
<div>
  Some examples of sensitive data include:&nbsp; 
</div> 
<div> 
 <ol> 
  <li>Information used in authentication (e.g. Credentials, PINs, Session identifiers, Tokens, Cookies…)&nbsp;</li> 
  <li>Information protected by laws, regulations or specific organizational policy (e.g. Credit Cards, Customers data)</li> 
 </ol> 
</div><div class="accordion" id="controls"><div class="card border-success"><div class="card-header " id="heading109"\><h5 class="mb-0"><button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse109" aria-expanded="true" aria-controls="collapse109">Countermeasure: Enforce HTTPS for sensitive information <span>[Hydras-AWS-S3-7.3]</span></button></h5></div><div id="collapse109" class="collapse" aria-labelledby="heading109" data-parent="#controls"><div class="card-body">	<p>Amazon Simple Storage Service is storage for the Internet. It is designed to make web-scale computing easier for developers. </p>

	<p>Amazon S3 has a simple web services interface that you can use to store and retrieve any amount of data, at any time, from anywhere on the web. It gives any developer access to the same highly scalable, reliable, fast, inexpensive data storage infrastructure that Amazon uses to run its own global network of web sites. </p>

	<p>To ensure that data is only accessible via HTTPS (as opposed to both HTTP and HTTPS) it is possible to add a condition to the S3 bucket policy. It is recommended to enable this for any bucket containing sensitive data to ensure that data is encrypted in transit.</p>

	<p>Remediation:<br />
The following is an example of how to create an S3 bucket policy that enforces HTTPS/SSL only:<br />
1. Sign in to the AWS Management Console (with S3 update privileges) <br />
2. Go to the S3 Service on the AWS Console <br />
3. Select a bucket under &#8220;All buckets&#8221; <br />
4. Click the properties tab <br />
5. Under the permissions select &#8220;Add a bucket policy&#8221; <br />
6. Add the following policy to ensure all objects are accessed via https only <br />
{<br />
<a href="%5B">Statement</a> {<br />
&#8220;Action&#8221;: &#8220;s3:*&#8221;,<br />
<a href="">Effect</a>&#8220;Allow&#8221;,<br />
&#8220;Principal&#8221;: &#8220;*&#8221;,<br />
<a href="">Resource</a>&#8220;arn:aws:s3:::bucketname/*&#8221;,<br />
<a href="%7B">Condition</a><br />
&#8220;Bool&#8221;:<br />
{ <br />
&#8220;aws:SecureTransport&#8221;: true <br />
}<br />
}<br />
} ]<br />
}<br />
7. Click &#8220;&#8220;Save&#8221; </p>

	<p>Content provided by Hydras IT LTD</p></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></body></html>